/**
 * @file 图片转换非法格式测试
 * @description 验证传入不支持的输出格式时抛错
 * @author YYC
 * @created 2025-10-31
 */

import { describe, it, expect } from "vitest";

import { convertImage } from "./image";

const tinyPng = Buffer.from(
  // 1x1 PNG（最简）
  Uint8Array.from([
    0x89,0x50,0x4e,0x47,0x0d,0x0a,0x1a,0x0a,0x00,0x00,0x00,0x0d,0x49,0x48,0x44,0x52,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x08,0x06,0x00,0x00,0x00,0x1f,0x15,0xc4,0x89,0x00,0x00,0x00,0x0a,0x49,0x44,0x41,0x54,0x78,0x9c,0x63,0x60,0x00,0x00,0x00,0x02,0x00,0x01,0x0c,0x02,0x2c,0x60,0x00,0x00,0x00,0x00,0x49,0x45,0x4e,0x44,0xae,0x42,0x60,0x82
  ])
);

describe("convertImage invalid format", () => {
  it("should throw when target format is unsupported", async () => {
    await expect(convertImage(tinyPng, "bmp" as any)).rejects.toThrow(/不支持的目标格式/);
  });
});

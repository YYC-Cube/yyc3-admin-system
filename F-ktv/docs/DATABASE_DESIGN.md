# ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¯æ™ºKTVå•†å®¶åå°ç®¡ç†ç³»ç»Ÿçš„å®Œæ•´æ•°æ®åº“è®¾è®¡ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ ¸å¿ƒæ•°æ®åº“ï¼š`yyc3_yy`ï¼ˆä¸šåŠ¡ä¸»åº“ï¼‰ã€`yyc3_hr`ï¼ˆäººåŠ›èµ„æºï¼‰ã€`yyc3_audit`ï¼ˆå®¡è®¡æ—¥å¿—ï¼‰ã€‚

---

## ğŸ“‘ ç›®å½•

- [æ•°æ®åº“æ¶æ„](#æ•°æ®åº“æ¶æ„)
- [yyc3_yy ä¸šåŠ¡ä¸»åº“](#yyc3_yy-ä¸šåŠ¡ä¸»åº“)
- [yyc3_hr äººåŠ›èµ„æºåº“](#yyc3_hr-äººåŠ›èµ„æºåº“)
- [yyc3_audit å®¡è®¡æ—¥å¿—åº“](#yyc3_audit-å®¡è®¡æ—¥å¿—åº“)
- [ç´¢å¼•è®¾è®¡](#ç´¢å¼•è®¾è®¡)
- [å…³ç³»å›¾è°±](#å…³ç³»å›¾è°±)
- [æ•°æ®è¿ç§»](#æ•°æ®è¿ç§»)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å¤‡ä»½ç­–ç•¥](#å¤‡ä»½ç­–ç•¥)

---

## æ•°æ®åº“æ¶æ„

### æ€»ä½“è®¾è®¡

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MySQL 8.0+                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   yyc3_yy       â”‚   yyc3_hr       â”‚   yyc3_audit    â”‚
â”‚  (ä¸šåŠ¡ä¸»åº“)      â”‚  (äººåŠ›èµ„æº)      â”‚  (å®¡è®¡æ—¥å¿—)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å•†å“ç®¡ç†       â”‚ â€¢ å‘˜å·¥ä¿¡æ¯       â”‚ â€¢ æ“ä½œæ—¥å¿—       â”‚
â”‚ â€¢ è®¢å•ç®¡ç†       â”‚ â€¢ è€ƒå‹¤æ‰“å¡       â”‚ â€¢ æ•°æ®å˜æ›´       â”‚
â”‚ â€¢ ä¼šå‘˜ç®¡ç†       â”‚ â€¢ è–ªèµ„ç®¡ç†       â”‚ â€¢ ç™»å½•æ—¥å¿—       â”‚
â”‚ â€¢ åŒ…å¢ç®¡ç†       â”‚ â€¢ ç»©æ•ˆè€ƒæ ¸       â”‚ â€¢ ç³»ç»Ÿå®¡è®¡       â”‚
â”‚ â€¢ åº“å­˜ç®¡ç†       â”‚ â€¢ åŸ¹è®­è®°å½•       â”‚                 â”‚
â”‚ â€¢ æ”¯ä»˜è®°å½•       â”‚ â€¢ æ‹›è˜ç®¡ç†       â”‚                 â”‚
â”‚ â€¢ AIè¿è¥æ•°æ®     â”‚                 â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### ç¯å¢ƒé…ç½®

\`\`\`ini
# yyc3_yy æ•°æ®åº“è¿æ¥
YYC3_YY_DB_HOST=localhost
YYC3_YY_DB_PORT=3306
YYC3_YY_DB_USER=devuser
YYC3_YY_DB_PASSWORD=devpassword
YYC3_YY_DB_NAME=yyc3_yy

# yyc3_hr æ•°æ®åº“è¿æ¥
HR_DB_HOST=localhost
HR_DB_NAME=yyc3_hr
HR_DB_USER=hr_admin
HR_DB_PASSWORD=secure_hr_pass

# yyc3_audit æ•°æ®åº“è¿æ¥
AUDIT_DB_NAME=yyc3_audit
AUDIT_DB_USER=audit_user
AUDIT_DB_PASSWORD=secure_audit_pass
\`\`\`

---

## yyc3_yy ä¸šåŠ¡ä¸»åº“

### 1. ç”¨æˆ·è®¤è¯è¡¨

#### users (ç”¨æˆ·è¡¨)

\`\`\`sql
CREATE TABLE `users` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `username` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` VARCHAR(255) NOT NULL COMMENT 'å¯†ç (åŠ å¯†)',
  `name` VARCHAR(100) NOT NULL COMMENT 'å§“å',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `email` VARCHAR(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT 'å¤´åƒURL',
  `role` ENUM('admin', 'manager', 'employee', 'cashier') NOT NULL DEFAULT 'employee' COMMENT 'è§’è‰²',
  `department` VARCHAR(50) DEFAULT NULL COMMENT 'éƒ¨é—¨',
  `status` ENUM('active', 'inactive', 'locked') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `last_login_at` DATETIME DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
  `last_login_ip` VARCHAR(45) DEFAULT NULL COMMENT 'æœ€åç™»å½•IP',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  KEY `idx_phone` (`phone`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·è¡¨';
\`\`\`

#### user_permissions (ç”¨æˆ·æƒé™è¡¨)

\`\`\`sql
CREATE TABLE `user_permissions` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æƒé™ID',
  `user_id` BIGINT UNSIGNED NOT NULL COMMENT 'ç”¨æˆ·ID',
  `permission` VARCHAR(100) NOT NULL COMMENT 'æƒé™æ ‡è¯†',
  `resource` VARCHAR(100) DEFAULT NULL COMMENT 'èµ„æºæ ‡è¯†',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_permission` (`permission`),
  CONSTRAINT `fk_user_permissions_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·æƒé™è¡¨';
\`\`\`

#### user_sessions (ç”¨æˆ·ä¼šè¯è¡¨)

\`\`\`sql
CREATE TABLE `user_sessions` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¼šè¯ID',
  `user_id` BIGINT UNSIGNED NOT NULL COMMENT 'ç”¨æˆ·ID',
  `token` VARCHAR(500) NOT NULL COMMENT 'JWT Token',
  `refresh_token` VARCHAR(500) DEFAULT NULL COMMENT 'åˆ·æ–°Token',
  `ip_address` VARCHAR(45) DEFAULT NULL COMMENT 'IPåœ°å€',
  `user_agent` VARCHAR(500) DEFAULT NULL COMMENT 'ç”¨æˆ·ä»£ç†',
  `expires_at` DATETIME NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_token` (`token`(255)),
  KEY `idx_expires_at` (`expires_at`),
  CONSTRAINT `fk_sessions_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·ä¼šè¯è¡¨';
\`\`\`

### 2. å•†å“ç®¡ç†è¡¨

#### categories (å•†å“åˆ†ç±»è¡¨)

\`\`\`sql
CREATE TABLE `categories` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'åˆ†ç±»ID',
  `parent_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'çˆ¶åˆ†ç±»ID',
  `name` VARCHAR(100) NOT NULL COMMENT 'åˆ†ç±»åç§°',
  `code` VARCHAR(50) DEFAULT NULL COMMENT 'åˆ†ç±»ç¼–ç ',
  `icon` VARCHAR(255) DEFAULT NULL COMMENT 'å›¾æ ‡',
  `sort_order` INT NOT NULL DEFAULT 0 COMMENT 'æ’åº',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_status` (`status`),
  KEY `idx_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å•†å“åˆ†ç±»è¡¨';
\`\`\`

#### products (å•†å“è¡¨)

\`\`\`sql
CREATE TABLE `products` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'å•†å“ID',
  `barcode` VARCHAR(50) DEFAULT NULL COMMENT 'æ¡å½¢ç ',
  `name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
  `alias` VARCHAR(200) DEFAULT NULL COMMENT 'å•†å“åˆ«å',
  `category_id` BIGINT UNSIGNED NOT NULL COMMENT 'åˆ†ç±»ID',
  `unit` VARCHAR(20) NOT NULL DEFAULT 'ä¸ª' COMMENT 'å•ä½',
  `original_price` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'åŸä»·',
  `sale_price` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å”®ä»·',
  `member_price` DECIMAL(10,2) DEFAULT NULL COMMENT 'ä¼šå‘˜ä»·',
  `cost` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'æˆæœ¬',
  `min_stock` INT NOT NULL DEFAULT 0 COMMENT 'æœ€ä½åº“å­˜',
  `can_discount` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'æ˜¯å¦å¯æ‰“æŠ˜',
  `is_gift` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦èµ å“',
  `is_sale_product` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦ä¿ƒé”€å•†å“',
  `is_recommended` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦æ¨è',
  `show_to_consumer` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'æ˜¯å¦å¯¹æ¶ˆè´¹è€…å¯è§',
  `image` VARCHAR(500) DEFAULT NULL COMMENT 'å•†å“å›¾ç‰‡',
  `description` TEXT DEFAULT NULL COMMENT 'å•†å“æè¿°',
  `tags` JSON DEFAULT NULL COMMENT 'æ ‡ç­¾',
  `flavors` JSON DEFAULT NULL COMMENT 'å£å‘³é€‰é¡¹',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_barcode` (`barcode`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_name` (`name`),
  KEY `idx_status` (`status`),
  KEY `idx_sale_price` (`sale_price`),
  FULLTEXT KEY `ft_name_alias` (`name`, `alias`),
  CONSTRAINT `fk_products_category` FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å•†å“è¡¨';
\`\`\`

#### suppliers (ä¾›åº”å•†è¡¨)

\`\`\`sql
CREATE TABLE `suppliers` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¾›åº”å•†ID',
  `code` VARCHAR(50) NOT NULL COMMENT 'ä¾›åº”å•†ç¼–ç ',
  `name` VARCHAR(200) NOT NULL COMMENT 'ä¾›åº”å•†åç§°',
  `contact_person` VARCHAR(100) DEFAULT NULL COMMENT 'è”ç³»äºº',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
  `email` VARCHAR(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `address` VARCHAR(500) DEFAULT NULL COMMENT 'åœ°å€',
  `bank_account` VARCHAR(100) DEFAULT NULL COMMENT 'é“¶è¡Œè´¦å·',
  `tax_number` VARCHAR(50) DEFAULT NULL COMMENT 'ç¨å·',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  KEY `idx_name` (`name`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¾›åº”å•†è¡¨';
\`\`\`

### 3. åº“å­˜ç®¡ç†è¡¨

#### warehouses (ä»“åº“è¡¨)

\`\`\`sql
CREATE TABLE `warehouses` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä»“åº“ID',
  `code` VARCHAR(50) NOT NULL COMMENT 'ä»“åº“ç¼–ç ',
  `name` VARCHAR(200) NOT NULL COMMENT 'ä»“åº“åç§°',
  `type` ENUM('main', 'branch', 'virtual') NOT NULL DEFAULT 'main' COMMENT 'ä»“åº“ç±»å‹',
  `address` VARCHAR(500) DEFAULT NULL COMMENT 'åœ°å€',
  `manager_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ç®¡ç†å‘˜ID',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  KEY `idx_manager_id` (`manager_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä»“åº“è¡¨';
\`\`\`

#### inventory (åº“å­˜è¡¨)

\`\`\`sql
CREATE TABLE `inventory` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'åº“å­˜ID',
  `product_id` BIGINT UNSIGNED NOT NULL COMMENT 'å•†å“ID',
  `warehouse_id` BIGINT UNSIGNED NOT NULL COMMENT 'ä»“åº“ID',
  `quantity` INT NOT NULL DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡',
  `available_quantity` INT NOT NULL DEFAULT 0 COMMENT 'å¯ç”¨æ•°é‡',
  `locked_quantity` INT NOT NULL DEFAULT 0 COMMENT 'é”å®šæ•°é‡',
  `avg_cost` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å¹³å‡æˆæœ¬',
  `last_inbound_date` DATETIME DEFAULT NULL COMMENT 'æœ€åå…¥åº“æ—¶é—´',
  `last_outbound_date` DATETIME DEFAULT NULL COMMENT 'æœ€åå‡ºåº“æ—¶é—´',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_product_warehouse` (`product_id`, `warehouse_id`),
  KEY `idx_warehouse_id` (`warehouse_id`),
  KEY `idx_quantity` (`quantity`),
  CONSTRAINT `fk_inventory_product` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`),
  CONSTRAINT `fk_inventory_warehouse` FOREIGN KEY (`warehouse_id`) REFERENCES `warehouses` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åº“å­˜è¡¨';
\`\`\`

#### inventory_transactions (åº“å­˜æµæ°´è¡¨)

\`\`\`sql
CREATE TABLE `inventory_transactions` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æµæ°´ID',
  `transaction_number` VARCHAR(50) NOT NULL COMMENT 'æµæ°´å•å·',
  `product_id` BIGINT UNSIGNED NOT NULL COMMENT 'å•†å“ID',
  `warehouse_id` BIGINT UNSIGNED NOT NULL COMMENT 'ä»“åº“ID',
  `type` ENUM('inbound', 'outbound') NOT NULL COMMENT 'ç±»å‹',
  `sub_type` ENUM('purchase', 'return', 'transfer', 'sale', 'loss', 'adjustment') NOT NULL COMMENT 'å­ç±»å‹',
  `quantity` INT NOT NULL COMMENT 'æ•°é‡',
  `before_quantity` INT NOT NULL COMMENT 'å˜åŠ¨å‰æ•°é‡',
  `after_quantity` INT NOT NULL COMMENT 'å˜åŠ¨åæ•°é‡',
  `cost` DECIMAL(10,2) DEFAULT NULL COMMENT 'æˆæœ¬',
  `related_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'å…³è”å•æ®ID',
  `operator_id` BIGINT UNSIGNED NOT NULL COMMENT 'æ“ä½œäººID',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_transaction_number` (`transaction_number`),
  KEY `idx_product_id` (`product_id`),
  KEY `idx_warehouse_id` (`warehouse_id`),
  KEY `idx_type` (`type`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_transactions_product` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`),
  CONSTRAINT `fk_transactions_warehouse` FOREIGN KEY (`warehouse_id`) REFERENCES `warehouses` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åº“å­˜æµæ°´è¡¨';
\`\`\`

### 4. åŒ…å¢ç®¡ç†è¡¨

#### rooms (åŒ…å¢è¡¨)

\`\`\`sql
CREATE TABLE `rooms` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'åŒ…å¢ID',
  `number` VARCHAR(50) NOT NULL COMMENT 'åŒ…å¢å·',
  `name` VARCHAR(100) DEFAULT NULL COMMENT 'åŒ…å¢åç§°',
  `type` ENUM('small', 'medium', 'large', 'vip', 'private') NOT NULL COMMENT 'åŒ…å¢ç±»å‹',
  `area` VARCHAR(50) DEFAULT NULL COMMENT 'åŒºåŸŸ',
  `floor` INT DEFAULT NULL COMMENT 'æ¥¼å±‚',
  `capacity` INT NOT NULL COMMENT 'å®¹çº³äººæ•°',
  `hourly_rate` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'æ—¶ç§Ÿä»·æ ¼',
  `member_hourly_rate` DECIMAL(10,2) DEFAULT NULL COMMENT 'ä¼šå‘˜æ—¶ç§Ÿä»·æ ¼',
  `min_consumption` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æœ€ä½æ¶ˆè´¹',
  `member_min_consumption` DECIMAL(10,2) DEFAULT NULL COMMENT 'ä¼šå‘˜æœ€ä½æ¶ˆè´¹',
  `features` JSON DEFAULT NULL COMMENT 'ç‰¹è‰²è®¾æ–½',
  `equipment` JSON DEFAULT NULL COMMENT 'è®¾å¤‡æ¸…å•',
  `status` ENUM('available', 'occupied', 'cleaning', 'maintenance', 'reserved') NOT NULL DEFAULT 'available' COMMENT 'çŠ¶æ€',
  `current_order_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'å½“å‰è®¢å•ID',
  `last_cleaned_at` DATETIME DEFAULT NULL COMMENT 'æœ€åæ¸…æ´æ—¶é—´',
  `maintenance_schedule` DATETIME DEFAULT NULL COMMENT 'ç»´æŠ¤è®¡åˆ’',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_number` (`number`),
  KEY `idx_type` (`type`),
  KEY `idx_status` (`status`),
  KEY `idx_area_floor` (`area`, `floor`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åŒ…å¢è¡¨';
\`\`\`

#### room_usage_history (åŒ…å¢ä½¿ç”¨å†å²è¡¨)

\`\`\`sql
CREATE TABLE `room_usage_history` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'å†å²ID',
  `room_id` BIGINT UNSIGNED NOT NULL COMMENT 'åŒ…å¢ID',
  `order_id` BIGINT UNSIGNED NOT NULL COMMENT 'è®¢å•ID',
  `start_time` DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
  `end_time` DATETIME DEFAULT NULL COMMENT 'ç»“æŸæ—¶é—´',
  `duration` INT DEFAULT NULL COMMENT 'æ—¶é•¿(åˆ†é’Ÿ)',
  `guest_count` INT DEFAULT NULL COMMENT 'å®¢äººæ•°é‡',
  `revenue` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æ”¶å…¥',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_room_id` (`room_id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_start_time` (`start_time`),
  CONSTRAINT `fk_usage_room` FOREIGN KEY (`room_id`) REFERENCES `rooms` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åŒ…å¢ä½¿ç”¨å†å²è¡¨';
\`\`\`

### 5. è®¢å•ç®¡ç†è¡¨

#### orders (è®¢å•è¡¨)

\`\`\`sql
CREATE TABLE `orders` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è®¢å•ID',
  `order_number` VARCHAR(50) NOT NULL COMMENT 'è®¢å•å·',
  `order_type` ENUM('dine_in', 'takeout', 'delivery', 'room_service') NOT NULL COMMENT 'è®¢å•ç±»å‹',
  `room_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'åŒ…å¢ID',
  `customer_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ä¼šå‘˜ID',
  `employee_id` BIGINT UNSIGNED NOT NULL COMMENT 'å‘˜å·¥ID',
  `status` ENUM('pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled') NOT NULL DEFAULT 'pending' COMMENT 'çŠ¶æ€',
  `subtotal` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å°è®¡',
  `discount_type` ENUM('percentage', 'amount', 'none') DEFAULT 'none' COMMENT 'æŠ˜æ‰£ç±»å‹',
  `discount_value` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æŠ˜æ‰£å€¼',
  `discount_amount` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'æŠ˜æ‰£é‡‘é¢',
  `service_charge` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'æœåŠ¡è´¹',
  `tax` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'ç¨è´¹',
  `total` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'æ€»é‡‘é¢',
  `payment_status` ENUM('unpaid', 'partial', 'paid', 'refunded') NOT NULL DEFAULT 'unpaid' COMMENT 'æ”¯ä»˜çŠ¶æ€',
  `payment_method` VARCHAR(50) DEFAULT NULL COMMENT 'æ”¯ä»˜æ–¹å¼',
  `delivery_address` JSON DEFAULT NULL COMMENT 'é…é€åœ°å€',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `completed_at` DATETIME DEFAULT NULL COMMENT 'å®Œæˆæ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_number` (`order_number`),
  KEY `idx_room_id` (`room_id`),
  KEY `idx_customer_id` (`customer_id`),
  KEY `idx_employee_id` (`employee_id`),
  KEY `idx_status` (`status`),
  KEY `idx_payment_status` (`payment_status`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_orders_room` FOREIGN KEY (`room_id`) REFERENCES `rooms` (`id`),
  CONSTRAINT `fk_orders_customer` FOREIGN KEY (`customer_id`) REFERENCES `members` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è®¢å•è¡¨';
\`\`\`

#### order_items (è®¢å•æ˜ç»†è¡¨)

\`\`\`sql
CREATE TABLE `order_items` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ˜ç»†ID',
  `order_id` BIGINT UNSIGNED NOT NULL COMMENT 'è®¢å•ID',
  `product_id` BIGINT UNSIGNED NOT NULL COMMENT 'å•†å“ID',
  `product_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
  `quantity` INT NOT NULL COMMENT 'æ•°é‡',
  `unit_price` DECIMAL(10,2) NOT NULL COMMENT 'å•ä»·',
  `subtotal` DECIMAL(10,2) NOT NULL COMMENT 'å°è®¡',
  `discount` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æŠ˜æ‰£',
  `actual_price` DECIMAL(10,2) NOT NULL COMMENT 'å®é™…ä»·æ ¼',
  `flavors` JSON DEFAULT NULL COMMENT 'å£å‘³',
  `status` ENUM('pending', 'confirmed', 'preparing', 'ready', 'served', 'cancelled') NOT NULL DEFAULT 'pending' COMMENT 'çŠ¶æ€',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_product_id` (`product_id`),
  KEY `idx_status` (`status`),
  CONSTRAINT `fk_items_order` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_items_product` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è®¢å•æ˜ç»†è¡¨';
\`\`\`

#### order_timeline (è®¢å•æ—¶é—´çº¿è¡¨)

\`\`\`sql
CREATE TABLE `order_timeline` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ—¶é—´çº¿ID',
  `order_id` BIGINT UNSIGNED NOT NULL COMMENT 'è®¢å•ID',
  `action` VARCHAR(100) NOT NULL COMMENT 'æ“ä½œ',
  `operator_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'æ“ä½œäººID',
  `operator_name` VARCHAR(100) DEFAULT NULL COMMENT 'æ“ä½œäººå§“å',
  `details` TEXT DEFAULT NULL COMMENT 'è¯¦æƒ…',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_timeline_order` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è®¢å•æ—¶é—´çº¿è¡¨';
\`\`\`

### 6. ä¼šå‘˜ç®¡ç†è¡¨

#### members (ä¼šå‘˜è¡¨)

\`\`\`sql
CREATE TABLE `members` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¼šå‘˜ID',
  `member_number` VARCHAR(50) NOT NULL COMMENT 'ä¼šå‘˜å·',
  `name` VARCHAR(100) NOT NULL COMMENT 'å§“å',
  `phone` VARCHAR(20) NOT NULL COMMENT 'æ‰‹æœºå·',
  `email` VARCHAR(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `gender` ENUM('male', 'female') DEFAULT NULL COMMENT 'æ€§åˆ«',
  `birthday` DATE DEFAULT NULL COMMENT 'ç”Ÿæ—¥',
  `avatar` VARCHAR(500) DEFAULT NULL COMMENT 'å¤´åƒ',
  `level_id` BIGINT UNSIGNED NOT NULL COMMENT 'ç­‰çº§ID',
  `points` INT NOT NULL DEFAULT 0 COMMENT 'ç§¯åˆ†',
  `balance` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'ä½™é¢',
  `total_consumption` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'ç´¯è®¡æ¶ˆè´¹',
  `total_orders` INT NOT NULL DEFAULT 0 COMMENT 'è®¢å•æ•°é‡',
  `avg_order_value` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å¹³å‡å®¢å•ä»·',
  `last_visit` DATETIME DEFAULT NULL COMMENT 'æœ€ååˆ°è®¿',
  `join_date` DATE NOT NULL COMMENT 'åŠ å…¥æ—¥æœŸ',
  `expiry_date` DATE DEFAULT NULL COMMENT 'åˆ°æœŸæ—¥æœŸ',
  `status` ENUM('active', 'inactive', 'expired', 'blacklist') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `tags` JSON DEFAULT NULL COMMENT 'æ ‡ç­¾',
  `address` VARCHAR(500) DEFAULT NULL COMMENT 'åœ°å€',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_member_number` (`member_number`),
  UNIQUE KEY `uk_phone` (`phone`),
  KEY `idx_level_id` (`level_id`),
  KEY `idx_status` (`status`),
  KEY `idx_points` (`points`),
  KEY `idx_balance` (`balance`),
  KEY `idx_join_date` (`join_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¼šå‘˜è¡¨';
\`\`\`

#### member_levels (ä¼šå‘˜ç­‰çº§è¡¨)

\`\`\`sql
CREATE TABLE `member_levels` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç­‰çº§ID',
  `name` VARCHAR(50) NOT NULL COMMENT 'ç­‰çº§åç§°',
  `code` VARCHAR(50) NOT NULL COMMENT 'ç­‰çº§ç¼–ç ',
  `discount_rate` DECIMAL(5,2) NOT NULL DEFAULT 100.00 COMMENT 'æŠ˜æ‰£ç‡(%)',
  `min_consumption` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'æœ€ä½æ¶ˆè´¹è¦æ±‚',
  `points_rate` DECIMAL(5,2) NOT NULL DEFAULT 1.00 COMMENT 'ç§¯åˆ†æ¯”ä¾‹',
  `benefits` JSON DEFAULT NULL COMMENT 'ä¼šå‘˜æƒç›Š',
  `color` VARCHAR(20) DEFAULT NULL COMMENT 'ç­‰çº§é¢œè‰²',
  `icon` VARCHAR(255) DEFAULT NULL COMMENT 'ç­‰çº§å›¾æ ‡',
  `sort_order` INT NOT NULL DEFAULT 0 COMMENT 'æ’åº',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  KEY `idx_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¼šå‘˜ç­‰çº§è¡¨';
\`\`\`

#### member_balance_log (ä¼šå‘˜ä½™é¢æ—¥å¿—è¡¨)

\`\`\`sql
CREATE TABLE `member_balance_log` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  `member_id` BIGINT UNSIGNED NOT NULL COMMENT 'ä¼šå‘˜ID',
  `type` ENUM('recharge', 'consume', 'refund', 'adjustment', 'gift') NOT NULL COMMENT 'ç±»å‹',
  `amount` DECIMAL(10,2) NOT NULL COMMENT 'é‡‘é¢',
  `before_balance` DECIMAL(10,2) NOT NULL COMMENT 'å˜åŠ¨å‰ä½™é¢',
  `after_balance` DECIMAL(10,2) NOT NULL COMMENT 'å˜åŠ¨åä½™é¢',
  `payment_method` VARCHAR(50) DEFAULT NULL COMMENT 'æ”¯ä»˜æ–¹å¼',
  `related_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'å…³è”å•æ®ID',
  `operator_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'æ“ä½œäººID',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_member_id` (`member_id`),
  KEY `idx_type` (`type`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_balance_member` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¼šå‘˜ä½™é¢æ—¥å¿—è¡¨';
\`\`\`

#### member_points_log (ä¼šå‘˜ç§¯åˆ†æ—¥å¿—è¡¨)

\`\`\`sql
CREATE TABLE `member_points_log` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  `member_id` BIGINT UNSIGNED NOT NULL COMMENT 'ä¼šå‘˜ID',
  `type` ENUM('earn', 'spend', 'expire', 'adjustment', 'gift') NOT NULL COMMENT 'ç±»å‹',
  `points` INT NOT NULL COMMENT 'ç§¯åˆ†',
  `before_points` INT NOT NULL COMMENT 'å˜åŠ¨å‰ç§¯åˆ†',
  `after_points` INT NOT NULL COMMENT 'å˜åŠ¨åç§¯åˆ†',
  `related_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'å…³è”å•æ®ID',
  `expire_date` DATE DEFAULT NULL COMMENT 'è¿‡æœŸæ—¥æœŸ',
  `operator_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'æ“ä½œäººID',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_member_id` (`member_id`),
  KEY `idx_type` (`type`),
  KEY `idx_expire_date` (`expire_date`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_points_member` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¼šå‘˜ç§¯åˆ†æ—¥å¿—è¡¨';
\`\`\`

### 7. æ”¯ä»˜ç®¡ç†è¡¨

#### payments (æ”¯ä»˜è¡¨)

\`\`\`sql
CREATE TABLE `payments` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ”¯ä»˜ID',
  `payment_number` VARCHAR(50) NOT NULL COMMENT 'æ”¯ä»˜å•å·',
  `order_id` BIGINT UNSIGNED NOT NULL COMMENT 'è®¢å•ID',
  `member_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ä¼šå‘˜ID',
  `payment_method` ENUM('cash', 'card', 'wechat', 'alipay', 'member') NOT NULL COMMENT 'æ”¯ä»˜æ–¹å¼',
  `amount` DECIMAL(10,2) NOT NULL COMMENT 'æ”¯ä»˜é‡‘é¢',
  `status` ENUM('pending', 'success', 'failed', 'cancelled', 'refunded') NOT NULL DEFAULT 'pending' COMMENT 'çŠ¶æ€',
  `transaction_id` VARCHAR(100) DEFAULT NULL COMMENT 'ç¬¬ä¸‰æ–¹äº¤æ˜“å·',
  `qr_code_url` VARCHAR(500) DEFAULT NULL COMMENT 'äºŒç»´ç URL',
  `paid_at` DATETIME DEFAULT NULL COMMENT 'æ”¯ä»˜æ—¶é—´',
  `refunded_at` DATETIME DEFAULT NULL COMMENT 'é€€æ¬¾æ—¶é—´',
  `refund_amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'é€€æ¬¾é‡‘é¢',
  `refund_reason` TEXT DEFAULT NULL COMMENT 'é€€æ¬¾åŸå› ',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_payment_number` (`payment_number`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_member_id` (`member_id`),
  KEY `idx_payment_method` (`payment_method`),
  KEY `idx_status` (`status`),
  KEY `idx_transaction_id` (`transaction_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_payments_order` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ”¯ä»˜è¡¨';
\`\`\`

### 8. AIè¿è¥ç³»ç»Ÿè¡¨

#### ai_recommendations (AIæ¨èè¡¨)

\`\`\`sql
CREATE TABLE `ai_recommendations` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ¨èID',
  `module` VARCHAR(50) NOT NULL COMMENT 'æ¨¡å—(M7.1-M7.9)',
  `type` VARCHAR(50) NOT NULL COMMENT 'æ¨èç±»å‹',
  `target_type` VARCHAR(50) NOT NULL COMMENT 'ç›®æ ‡ç±»å‹',
  `target_id` VARCHAR(100) NOT NULL COMMENT 'ç›®æ ‡ID',
  `content` JSON NOT NULL COMMENT 'æ¨èå†…å®¹',
  `confidence` DECIMAL(5,4) NOT NULL DEFAULT 0.0000 COMMENT 'ç½®ä¿¡åº¦',
  `priority` ENUM('high', 'medium', 'low') NOT NULL DEFAULT 'medium' COMMENT 'ä¼˜å…ˆçº§',
  `status` ENUM('pending', 'active', 'completed', 'expired') NOT NULL DEFAULT 'pending' COMMENT 'çŠ¶æ€',
  `executed_at` DATETIME DEFAULT NULL COMMENT 'æ‰§è¡Œæ—¶é—´',
  `result` JSON DEFAULT NULL COMMENT 'æ‰§è¡Œç»“æœ',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `expires_at` DATETIME DEFAULT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_module` (`module`),
  KEY `idx_target` (`target_type`, `target_id`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='AIæ¨èè¡¨';
\`\`\`

#### ai_predictions (AIé¢„æµ‹è¡¨)

\`\`\`sql
CREATE TABLE `ai_predictions` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'é¢„æµ‹ID',
  `module` VARCHAR(50) NOT NULL COMMENT 'æ¨¡å—',
  `prediction_type` VARCHAR(50) NOT NULL COMMENT 'é¢„æµ‹ç±»å‹',
  `target_date` DATE NOT NULL COMMENT 'ç›®æ ‡æ—¥æœŸ',
  `prediction_data` JSON NOT NULL COMMENT 'é¢„æµ‹æ•°æ®',
  `actual_data` JSON DEFAULT NULL COMMENT 'å®é™…æ•°æ®',
  `accuracy` DECIMAL(5,2) DEFAULT NULL COMMENT 'å‡†ç¡®ç‡(%)',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_module` (`module`),
  KEY `idx_target_date` (`target_date`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='AIé¢„æµ‹è¡¨';
\`\`\`

#### marketing_campaigns (è¥é”€æ´»åŠ¨è¡¨)

\`\`\`sql
CREATE TABLE `marketing_campaigns` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ´»åŠ¨ID',
  `campaign_number` VARCHAR(50) NOT NULL COMMENT 'æ´»åŠ¨ç¼–å·',
  `name` VARCHAR(200) NOT NULL COMMENT 'æ´»åŠ¨åç§°',
  `type` VARCHAR(50) NOT NULL COMMENT 'æ´»åŠ¨ç±»å‹',
  `channels` JSON NOT NULL COMMENT 'æ¨é€æ¸ é“',
  `target_audience` JSON NOT NULL COMMENT 'ç›®æ ‡å—ä¼—',
  `content` JSON NOT NULL COMMENT 'æ´»åŠ¨å†…å®¹',
  `budget` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'é¢„ç®—',
  `actual_cost` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'å®é™…æˆæœ¬',
  `target_reach` INT DEFAULT 0 COMMENT 'ç›®æ ‡è§¦è¾¾',
  `actual_reach` INT DEFAULT 0 COMMENT 'å®é™…è§¦è¾¾',
  `conversion_count` INT DEFAULT 0 COMMENT 'è½¬åŒ–æ•°é‡',
  `conversion_rate` DECIMAL(5,2) DEFAULT 0.00 COMMENT 'è½¬åŒ–ç‡(%)',
  `revenue` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æ”¶å…¥',
  `roi` DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æŠ•èµ„å›æŠ¥ç‡',
  `start_date` DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
  `end_date` DATETIME NOT NULL COMMENT 'ç»“æŸæ—¶é—´',
  `status` ENUM('draft', 'scheduled', 'active', 'paused', 'completed', 'cancelled') NOT NULL DEFAULT 'draft' COMMENT 'çŠ¶æ€',
  `created_by` BIGINT UNSIGNED NOT NULL COMMENT 'åˆ›å»ºäººID',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_campaign_number` (`campaign_number`),
  KEY `idx_status` (`status`),
  KEY `idx_start_date` (`start_date`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è¥é”€æ´»åŠ¨è¡¨';
\`\`\`

---

## yyc3_hr äººåŠ›èµ„æºåº“

### 1. å‘˜å·¥ä¿¡æ¯è¡¨

#### hr_employees (å‘˜å·¥ä¿¡æ¯è¡¨)

\`\`\`sql
CREATE TABLE `hr_employees` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'å‘˜å·¥ID',
  `employee_number` VARCHAR(50) NOT NULL COMMENT 'å·¥å·',
  `user_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'å…³è”ç”¨æˆ·ID(yyc3_yy.users)',
  `name` VARCHAR(100) NOT NULL COMMENT 'å§“å',
  `id_card` VARCHAR(20) DEFAULT NULL COMMENT 'èº«ä»½è¯å·',
  `phone` VARCHAR(20) NOT NULL COMMENT 'æ‰‹æœºå·',
  `email` VARCHAR(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `gender` ENUM('male', 'female') DEFAULT NULL COMMENT 'æ€§åˆ«',
  `birthday` DATE DEFAULT NULL COMMENT 'å‡ºç”Ÿæ—¥æœŸ',
  `nationality` VARCHAR(50) DEFAULT 'ä¸­å›½' COMMENT 'å›½ç±',
  `education` ENUM('primary', 'middle', 'high', 'associate', 'bachelor', 'master', 'doctor') DEFAULT NULL COMMENT 'å­¦å†',
  `marital_status` ENUM('single', 'married', 'divorced', 'widowed') DEFAULT NULL COMMENT 'å©šå§»çŠ¶å†µ',
  `avatar` VARCHAR(500) DEFAULT NULL COMMENT 'å¤´åƒ',
  `department_id` BIGINT UNSIGNED NOT NULL COMMENT 'éƒ¨é—¨ID',
  `position` VARCHAR(100) NOT NULL COMMENT 'èŒä½',
  `employee_type` ENUM('full_time', 'part_time', 'contract', 'intern') NOT NULL DEFAULT 'full_time' COMMENT 'å‘˜å·¥ç±»å‹',
  `work_location` VARCHAR(200) DEFAULT NULL COMMENT 'å·¥ä½œåœ°ç‚¹',
  `hire_date` DATE NOT NULL COMMENT 'å…¥èŒæ—¥æœŸ',
  `probation_end_date` DATE DEFAULT NULL COMMENT 'è¯•ç”¨æœŸç»“æŸæ—¥æœŸ',
  `contract_start_date` DATE DEFAULT NULL COMMENT 'åˆåŒå¼€å§‹æ—¥æœŸ',
  `contract_end_date` DATE DEFAULT NULL COMMENT 'åˆåŒç»“æŸæ—¥æœŸ',
  `resignation_date` DATE DEFAULT NULL COMMENT 'ç¦»èŒæ—¥æœŸ',
  `status` ENUM('active', 'inactive', 'on_leave', 'resigned') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `emergency_contact_name` VARCHAR(100) DEFAULT NULL COMMENT 'ç´§æ€¥è”ç³»äºº',
  `emergency_contact_phone` VARCHAR(20) DEFAULT NULL COMMENT 'ç´§æ€¥è”ç³»ç”µè¯',
  `emergency_contact_relationship` VARCHAR(50) DEFAULT NULL COMMENT 'ç´§æ€¥è”ç³»äººå…³ç³»',
  `address` VARCHAR(500) DEFAULT NULL COMMENT 'åœ°å€',
  `bank_name` VARCHAR(100) DEFAULT NULL COMMENT 'å¼€æˆ·é“¶è¡Œ',
  `bank_account` VARCHAR(50) DEFAULT NULL COMMENT 'é“¶è¡Œè´¦å·',
  `social_security_number` VARCHAR(50) DEFAULT NULL COMMENT 'ç¤¾ä¿å·',
  `provident_fund_account` VARCHAR(50) DEFAULT NULL COMMENT 'å…¬ç§¯é‡‘è´¦å·',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_employee_number` (`employee_number`),
  UNIQUE KEY `uk_phone` (`phone`),
  KEY `idx_department_id` (`department_id`),
  KEY `idx_status` (`status`),
  KEY `idx_hire_date` (`hire_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å‘˜å·¥ä¿¡æ¯è¡¨';
\`\`\`

#### hr_departments (éƒ¨é—¨è¡¨)

\`\`\`sql
CREATE TABLE `hr_departments` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'éƒ¨é—¨ID',
  `parent_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ä¸Šçº§éƒ¨é—¨ID',
  `name` VARCHAR(100) NOT NULL COMMENT 'éƒ¨é—¨åç§°',
  `code` VARCHAR(50) NOT NULL COMMENT 'éƒ¨é—¨ç¼–ç ',
  `manager_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'éƒ¨é—¨ç»ç†ID',
  `description` TEXT DEFAULT NULL COMMENT 'éƒ¨é—¨æè¿°',
  `sort_order` INT NOT NULL DEFAULT 0 COMMENT 'æ’åº',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_manager_id` (`manager_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='éƒ¨é—¨è¡¨';
\`\`\`

### 2. è€ƒå‹¤ç®¡ç†è¡¨

#### hr_attendance (è€ƒå‹¤è®°å½•è¡¨)

\`\`\`sql
CREATE TABLE `hr_attendance` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è€ƒå‹¤ID',
  `employee_id` BIGINT UNSIGNED NOT NULL COMMENT 'å‘˜å·¥ID',
  `date` DATE NOT NULL COMMENT 'æ—¥æœŸ',
  `shift_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ç­æ¬¡ID',
  `check_in_time` DATETIME DEFAULT NULL COMMENT 'ç­¾åˆ°æ—¶é—´',
  `check_in_location` VARCHAR(200) DEFAULT NULL COMMENT 'ç­¾åˆ°åœ°ç‚¹',
  `check_in_latitude` DECIMAL(10,6) DEFAULT NULL COMMENT 'ç­¾åˆ°çº¬åº¦',
  `check_in_longitude` DECIMAL(10,6) DEFAULT NULL COMMENT 'ç­¾åˆ°ç»åº¦',
  `check_out_time` DATETIME DEFAULT NULL COMMENT 'ç­¾é€€æ—¶é—´',
  `check_out_location` VARCHAR(200) DEFAULT NULL COMMENT 'ç­¾é€€åœ°ç‚¹',
  `check_out_latitude` DECIMAL(10,6) DEFAULT NULL COMMENT 'ç­¾é€€çº¬åº¦',
  `check_out_longitude` DECIMAL(10,6) DEFAULT NULL COMMENT 'ç­¾é€€ç»åº¦',
  `work_hours` DECIMAL(5,2) DEFAULT 0.00 COMMENT 'å·¥ä½œæ—¶é•¿(å°æ—¶)',
  `overtime_hours` DECIMAL(5,2) DEFAULT 0.00 COMMENT 'åŠ ç­æ—¶é•¿(å°æ—¶)',
  `status` ENUM('normal', 'late', 'early', 'absent', 'leave') NOT NULL DEFAULT 'normal' COMMENT 'çŠ¶æ€',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_employee_date` (`employee_id`, `date`),
  KEY `idx_date` (`date`),
  KEY `idx_status` (`status`),
  CONSTRAINT `fk_attendance_employee` FOREIGN KEY (`employee_id`) REFERENCES `hr_employees` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è€ƒå‹¤è®°å½•è¡¨';
\`\`\`

#### hr_shifts (ç­æ¬¡è¡¨)

\`\`\`sql
CREATE TABLE `hr_shifts` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç­æ¬¡ID',
  `name` VARCHAR(100) NOT NULL COMMENT 'ç­æ¬¡åç§°',
  `code` VARCHAR(50) NOT NULL COMMENT 'ç­æ¬¡ç¼–ç ',
  `start_time` TIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
  `end_time` TIME NOT NULL COMMENT 'ç»“æŸæ—¶é—´',
  `work_hours` DECIMAL(5,2) NOT NULL COMMENT 'å·¥ä½œæ—¶é•¿(å°æ—¶)',
  `late_tolerance` INT NOT NULL DEFAULT 0 COMMENT 'è¿Ÿåˆ°å®¹å¿(åˆ†é’Ÿ)',
  `early_tolerance` INT NOT NULL DEFAULT 0 COMMENT 'æ—©é€€å®¹å¿(åˆ†é’Ÿ)',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç­æ¬¡è¡¨';
\`\`\`

#### hr_leaves (è¯·å‡è®°å½•è¡¨)

\`\`\`sql
CREATE TABLE `hr_leaves` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è¯·å‡ID',
  `employee_id` BIGINT UNSIGNED NOT NULL COMMENT 'å‘˜å·¥ID',
  `leave_type` ENUM('annual', 'sick', 'personal', 'maternity', 'paternity', 'marriage', 'bereavement', 'other') NOT NULL COMMENT 'è¯·å‡ç±»å‹',
  `start_date` DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
  `end_date` DATE NOT NULL COMMENT 'ç»“æŸæ—¥æœŸ',
  `duration` DECIMAL(5,2) NOT NULL COMMENT 'æ—¶é•¿(å¤©)',
  `reason` TEXT NOT NULL COMMENT 'è¯·å‡åŸå› ',
  `attachments` JSON DEFAULT NULL COMMENT 'é™„ä»¶',
  `status` ENUM('pending', 'approved', 'rejected', 'cancelled') NOT NULL DEFAULT 'pending' COMMENT 'çŠ¶æ€',
  `approver_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'å®¡æ‰¹äººID',
  `approved_at` DATETIME DEFAULT NULL COMMENT 'å®¡æ‰¹æ—¶é—´',
  `reject_reason` TEXT DEFAULT NULL COMMENT 'æ‹’ç»åŸå› ',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_employee_id` (`employee_id`),
  KEY `idx_status` (`status`),
  KEY `idx_start_date` (`start_date`),
  CONSTRAINT `fk_leaves_employee` FOREIGN KEY (`employee_id`) REFERENCES `hr_employees` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è¯·å‡è®°å½•è¡¨';
\`\`\`

### 3. è–ªèµ„ç®¡ç†è¡¨

#### hr_salaries (è–ªèµ„è¡¨)

\`\`\`sql
CREATE TABLE `hr_salaries` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è–ªèµ„ID',
  `employee_id` BIGINT UNSIGNED NOT NULL COMMENT 'å‘˜å·¥ID',
  `year_month` VARCHAR(7) NOT NULL COMMENT 'å¹´æœˆ(YYYY-MM)',
  `base_salary` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'åŸºæœ¬å·¥èµ„',
  `performance_bonus` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'ç»©æ•ˆå¥–é‡‘',
  `attendance_bonus` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å…¨å‹¤å¥–',
  `overtime_pay` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'åŠ ç­è´¹',
  `commission` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'ææˆ',
  `allowances` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'æ´¥è´´è¡¥åŠ©',
  `gross_salary` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'åº”å‘å·¥èµ„',
  `social_security` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'ç¤¾ä¿',
  `provident_fund` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å…¬ç§¯é‡‘',
  `income_tax` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'ä¸ªäººæ‰€å¾—ç¨',
  `deductions` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å…¶ä»–æ‰£æ¬¾',
  `net_salary` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'å®å‘å·¥èµ„',
  `payment_status` ENUM('pending', 'paid', 'failed') NOT NULL DEFAULT 'pending' COMMENT 'æ”¯ä»˜çŠ¶æ€',
  `payment_date` DATE DEFAULT NULL COMMENT 'æ”¯ä»˜æ—¥æœŸ',
  `remark` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_employee_yearmonth` (`employee_id`, `year_month`),
  KEY `idx_year_month` (`year_month`),
  KEY `idx_payment_status` (`payment_status`),
  CONSTRAINT `fk_salaries_employee` FOREIGN KEY (`employee_id`) REFERENCES `hr_employees` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è–ªèµ„è¡¨';
\`\`\`

### 4. ç»©æ•ˆè€ƒæ ¸è¡¨

#### hr_performance (ç»©æ•ˆè®°å½•è¡¨)

\`\`\`sql
CREATE TABLE `hr_performance` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç»©æ•ˆID',
  `employee_id` BIGINT UNSIGNED NOT NULL COMMENT 'å‘˜å·¥ID',
  `period` VARCHAR(20) NOT NULL COMMENT 'è€ƒæ ¸å‘¨æœŸ',
  `period_type` ENUM('monthly', 'quarterly', 'annual') NOT NULL COMMENT 'å‘¨æœŸç±»å‹',
  `kpi_scores` JSON NOT NULL COMMENT 'KPIå¾—åˆ†',
  `total_score` DECIMAL(5,2) NOT NULL DEFAULT 0.00 COMMENT 'æ€»åˆ†',
  `rating` ENUM('excellent', 'good', 'average', 'poor') DEFAULT NULL COMMENT 'è¯„çº§',
  `feedback` TEXT DEFAULT NULL COMMENT 'è¯„ä»·åé¦ˆ',
  `reviewer_id` BIGINT UNSIGNED NOT NULL COMMENT 'è€ƒæ ¸äººID',
  `status` ENUM('draft', 'submitted', 'reviewed', 'confirmed') NOT NULL DEFAULT 'draft' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_employee_id` (`employee_id`),
  KEY `idx_period` (`period`),
  KEY `idx_status` (`status`),
  CONSTRAINT `fk_performance_employee` FOREIGN KEY (`employee_id`) REFERENCES `hr_employees` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç»©æ•ˆè®°å½•è¡¨';
\`\`\`

### 5. åŸ¹è®­ç®¡ç†è¡¨

#### hr_trainings (åŸ¹è®­è®°å½•è¡¨)

\`\`\`sql
CREATE TABLE `hr_trainings` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'åŸ¹è®­ID',
  `name` VARCHAR(200) NOT NULL COMMENT 'åŸ¹è®­åç§°',
  `type` ENUM('onboarding', 'skill', 'management', 'safety', 'other') NOT NULL COMMENT 'åŸ¹è®­ç±»å‹',
  `trainer` VARCHAR(100) DEFAULT NULL COMMENT 'åŸ¹è®­å¸ˆ',
  `start_date` DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
  `end_date` DATE NOT NULL COMMENT 'ç»“æŸæ—¥æœŸ',
  `location` VARCHAR(200) DEFAULT NULL COMMENT 'åŸ¹è®­åœ°ç‚¹',
  `description` TEXT DEFAULT NULL COMMENT 'åŸ¹è®­æè¿°',
  `capacity` INT DEFAULT NULL COMMENT 'å®¹çº³äººæ•°',
  `status` ENUM('scheduled', 'ongoing', 'completed', 'cancelled') NOT NULL DEFAULT 'scheduled' COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_start_date` (`start_date`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åŸ¹è®­è®°å½•è¡¨';
\`\`\`

#### hr_training_participants (åŸ¹è®­å‚ä¸è€…è¡¨)

\`\`\`sql
CREATE TABLE `hr_training_participants` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `training_id` BIGINT UNSIGNED NOT NULL COMMENT 'åŸ¹è®­ID',
  `employee_id` BIGINT UNSIGNED NOT NULL COMMENT 'å‘˜å·¥ID',
  `attendance_status` ENUM('registered', 'attended', 'absent', 'cancelled') NOT NULL DEFAULT 'registered' COMMENT 'å‡ºå¸­çŠ¶æ€',
  `score` DECIMAL(5,2) DEFAULT NULL COMMENT 'è€ƒæ ¸åˆ†æ•°',
  `passed` TINYINT(1) DEFAULT NULL COMMENT 'æ˜¯å¦é€šè¿‡',
  `certificate_url` VARCHAR(500) DEFAULT NULL COMMENT 'è¯ä¹¦URL',
  `feedback` TEXT DEFAULT NULL COMMENT 'åé¦ˆ',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_training_employee` (`training_id`, `employee_id`),
  KEY `idx_employee_id` (`employee_id`),
  CONSTRAINT `fk_participants_training` FOREIGN KEY (`training_id`) REFERENCES `hr_trainings` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_participants_employee` FOREIGN KEY (`employee_id`) REFERENCES `hr_employees` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åŸ¹è®­å‚ä¸è€…è¡¨';
\`\`\`

---

## yyc3_audit å®¡è®¡æ—¥å¿—åº“

### 1. æ“ä½œæ—¥å¿—è¡¨

#### audit_logs (æ“ä½œæ—¥å¿—è¡¨)

\`\`\`sql
CREATE TABLE `audit_logs` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  `user_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `username` VARCHAR(100) DEFAULT NULL COMMENT 'ç”¨æˆ·å',
  `action` VARCHAR(100) NOT NULL COMMENT 'æ“ä½œåŠ¨ä½œ',
  `resource_type` VARCHAR(50) NOT NULL COMMENT 'èµ„æºç±»å‹',
  `resource_id` VARCHAR(100) DEFAULT NULL COMMENT 'èµ„æºID',
  `method` VARCHAR(10) NOT NULL COMMENT 'è¯·æ±‚æ–¹æ³•',
  `url` VARCHAR(500) NOT NULL COMMENT 'è¯·æ±‚URL',
  `ip_address` VARCHAR(45) NOT NULL COMMENT 'IPåœ°å€',
  `user_agent` VARCHAR(500) DEFAULT NULL COMMENT 'ç”¨æˆ·ä»£ç†',
  `request_body` JSON DEFAULT NULL COMMENT 'è¯·æ±‚ä½“',
  `response_code` INT DEFAULT NULL COMMENT 'å“åº”ç ',
  `response_message` TEXT DEFAULT NULL COMMENT 'å“åº”æ¶ˆæ¯',
  `duration_ms` INT DEFAULT NULL COMMENT 'è€—æ—¶(æ¯«ç§’)',
  `status` ENUM('success', 'failed', 'error') NOT NULL COMMENT 'çŠ¶æ€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_action` (`action`),
  KEY `idx_resource_type` (`resource_type`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ“ä½œæ—¥å¿—è¡¨';
\`\`\`

### 2. æ•°æ®å˜æ›´æ—¥å¿—è¡¨

#### audit_data_changes (æ•°æ®å˜æ›´æ—¥å¿—è¡¨)

\`\`\`sql
CREATE TABLE `audit_data_changes` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'å˜æ›´ID',
  `user_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `database_name` VARCHAR(100) NOT NULL COMMENT 'æ•°æ®åº“å',
  `table_name` VARCHAR(100) NOT NULL COMMENT 'è¡¨å',
  `operation` ENUM('INSERT', 'UPDATE', 'DELETE') NOT NULL COMMENT 'æ“ä½œç±»å‹',
  `record_id` VARCHAR(100) NOT NULL COMMENT 'è®°å½•ID',
  `before_data` JSON DEFAULT NULL COMMENT 'å˜æ›´å‰æ•°æ®',
  `after_data` JSON DEFAULT NULL COMMENT 'å˜æ›´åæ•°æ®',
  `changed_fields` JSON DEFAULT NULL COMMENT 'å˜æ›´å­—æ®µ',
  `ip_address` VARCHAR(45) DEFAULT NULL COMMENT 'IPåœ°å€',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_table_name` (`table_name`),
  KEY `idx_operation` (`operation`),
  KEY `idx_record_id` (`record_id`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ•°æ®å˜æ›´æ—¥å¿—è¡¨';
\`\`\`

### 3. ç™»å½•æ—¥å¿—è¡¨

#### audit_login_logs (ç™»å½•æ—¥å¿—è¡¨)

\`\`\`sql
CREATE TABLE `audit_login_logs` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  `user_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `username` VARCHAR(100) NOT NULL COMMENT 'ç”¨æˆ·å',
  `login_type` ENUM('password', 'sms', 'wechat', 'other') NOT NULL COMMENT 'ç™»å½•æ–¹å¼',
  `ip_address` VARCHAR(45) NOT NULL COMMENT 'IPåœ°å€',
  `location` VARCHAR(200) DEFAULT NULL COMMENT 'ç™»å½•åœ°ç‚¹',
  `device_type` VARCHAR(50) DEFAULT NULL COMMENT 'è®¾å¤‡ç±»å‹',
  `user_agent` VARCHAR(500) DEFAULT NULL COMMENT 'ç”¨æˆ·ä»£ç†',
  `status` ENUM('success', 'failed') NOT NULL COMMENT 'çŠ¶æ€',
  `fail_reason` VARCHAR(500) DEFAULT NULL COMMENT 'å¤±è´¥åŸå› ',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_username` (`username`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç™»å½•æ—¥å¿—è¡¨';
\`\`\`

### 4. ç³»ç»Ÿå®¡è®¡è¡¨

#### audit_system_events (ç³»ç»Ÿäº‹ä»¶è¡¨)

\`\`\`sql
CREATE TABLE `audit_system_events` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'äº‹ä»¶ID',
  `event_type` VARCHAR(100) NOT NULL COMMENT 'äº‹ä»¶ç±»å‹',
  `severity` ENUM('info', 'warning', 'error', 'critical') NOT NULL DEFAULT 'info' COMMENT 'ä¸¥é‡ç¨‹åº¦',
  `module` VARCHAR(100) NOT NULL COMMENT 'æ¨¡å—',
  `message` TEXT NOT NULL COMMENT 'æ¶ˆæ¯',
  `details` JSON DEFAULT NULL COMMENT 'è¯¦æƒ…',
  `stack_trace` TEXT DEFAULT NULL COMMENT 'å †æ ˆè·Ÿè¸ª',
  `user_id` BIGINT UNSIGNED DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `ip_address` VARCHAR(45) DEFAULT NULL COMMENT 'IPåœ°å€',
  `resolved` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦å·²è§£å†³',
  `resolved_at` DATETIME DEFAULT NULL COMMENT 'è§£å†³æ—¶é—´',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_event_type` (`event_type`),
  KEY `idx_severity` (`severity`),
  KEY `idx_module` (`module`),
  KEY `idx_resolved` (`resolved`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç³»ç»Ÿäº‹ä»¶è¡¨';
\`\`\`

---

## ç´¢å¼•è®¾è®¡

### ç´¢å¼•è®¾è®¡åŸåˆ™

1. **ä¸»é”®ç´¢å¼•**: æ‰€æœ‰è¡¨ä½¿ç”¨è‡ªå¢BIGINTä½œä¸ºä¸»é”®
2. **å”¯ä¸€ç´¢å¼•**: ç”¨äºä¿è¯æ•°æ®å”¯ä¸€æ€§ï¼ˆå¦‚ç”¨æˆ·åã€æ‰‹æœºå·ã€è®¢å•å·ç­‰ï¼‰
3. **æ™®é€šç´¢å¼•**: ç”¨äºæé«˜æŸ¥è¯¢æ€§èƒ½ï¼ˆå¦‚çŠ¶æ€ã€æ—¥æœŸã€å¤–é”®ç­‰ï¼‰
4. **å…¨æ–‡ç´¢å¼•**: ç”¨äºå…¨æ–‡æœç´¢ï¼ˆå¦‚å•†å“åç§°ã€æè¿°ï¼‰
5. **ç»„åˆç´¢å¼•**: æ ¹æ®æŸ¥è¯¢é¢‘ç‡è®¾è®¡ï¼ˆå¦‚å‘˜å·¥ID+æ—¥æœŸã€å•†å“ID+ä»“åº“IDï¼‰

### å…³é”®ç´¢å¼•è¯´æ˜

#### yyc3_yy æ ¸å¿ƒç´¢å¼•

\`\`\`sql
-- ç”¨æˆ·è¡¨
ALTER TABLE users ADD INDEX idx_role_status (role, status);
ALTER TABLE users ADD INDEX idx_last_login (last_login_at);

-- å•†å“è¡¨
ALTER TABLE products ADD INDEX idx_category_status (category_id, status);
ALTER TABLE products ADD INDEX idx_price_range (sale_price, status);

-- è®¢å•è¡¨
ALTER TABLE orders ADD INDEX idx_customer_date (customer_id, created_at);
ALTER TABLE orders ADD INDEX idx_status_date (status, created_at);
ALTER TABLE orders ADD INDEX idx_payment_status (payment_status, status);

-- åº“å­˜è¡¨
ALTER TABLE inventory ADD INDEX idx_warehouse_quantity (warehouse_id, quantity);
ALTER TABLE inventory ADD INDEX idx_low_stock (quantity, product_id);

-- åŒ…å¢è¡¨
ALTER TABLE rooms ADD INDEX idx_status_type (status, type);

-- ä¼šå‘˜è¡¨
ALTER TABLE members ADD INDEX idx_level_status (level_id, status);
ALTER TABLE members ADD INDEX idx_points_balance (points, balance);
\`\`\`

#### yyc3_hr æ ¸å¿ƒç´¢å¼•

\`\`\`sql
-- å‘˜å·¥è¡¨
ALTER TABLE hr_employees ADD INDEX idx_department_status (department_id, status);
ALTER TABLE hr_employees ADD INDEX idx_hire_date (hire_date);

-- è€ƒå‹¤è¡¨
ALTER TABLE hr_attendance ADD INDEX idx_employee_date (employee_id, date);
ALTER TABLE hr_attendance ADD INDEX idx_date_status (date, status);

-- è–ªèµ„è¡¨
ALTER TABLE hr_salaries ADD INDEX idx_yearmonth_status (year_month, payment_status);
\`\`\`

#### yyc3_audit æ ¸å¿ƒç´¢å¼•

\`\`\`sql
-- æ“ä½œæ—¥å¿—è¡¨
ALTER TABLE audit_logs ADD INDEX idx_user_action (user_id, action);
ALTER TABLE audit_logs ADD INDEX idx_resource (resource_type, resource_id);
ALTER TABLE audit_logs ADD INDEX idx_date_status (created_at, status);

-- æ•°æ®å˜æ›´è¡¨
ALTER TABLE audit_data_changes ADD INDEX idx_table_operation (table_name, operation);
ALTER TABLE audit_data_changes ADD INDEX idx_record (table_name, record_id);
\`\`\`

---

## å…³ç³»å›¾è°±

### yyc3_yy æ ¸å¿ƒå…³ç³»

\`\`\`
users (ç”¨æˆ·)
  â”œâ”€â†’ user_permissions (æƒé™)
  â”œâ”€â†’ user_sessions (ä¼šè¯)
  â”œâ”€â†’ orders (è®¢å•ï¼Œä½œä¸ºå‘˜å·¥)
  â””â”€â†’ audit_logs (æ“ä½œæ—¥å¿—)

products (å•†å“)
  â”œâ”€â†’ categories (åˆ†ç±»)
  â”œâ”€â†’ inventory (åº“å­˜)
  â”œâ”€â†’ order_items (è®¢å•æ˜ç»†)
  â””â”€â†’ suppliers (ä¾›åº”å•†ï¼Œå¤šå¯¹å¤š)

orders (è®¢å•)
  â”œâ”€â†’ order_items (è®¢å•æ˜ç»†)
  â”œâ”€â†’ order_timeline (æ—¶é—´çº¿)
  â”œâ”€â†’ payments (æ”¯ä»˜)
  â”œâ”€â†’ members (ä¼šå‘˜)
  â”œâ”€â†’ rooms (åŒ…å¢)
  â””â”€â†’ users (å‘˜å·¥)

members (ä¼šå‘˜)
  â”œâ”€â†’ member_levels (ç­‰çº§)
  â”œâ”€â†’ member_balance_log (ä½™é¢æ—¥å¿—)
  â”œâ”€â†’ member_points_log (ç§¯åˆ†æ—¥å¿—)
  â””â”€â†’ orders (è®¢å•)

rooms (åŒ…å¢)
  â”œâ”€â†’ orders (è®¢å•)
  â””â”€â†’ room_usage_history (ä½¿ç”¨å†å²)

warehouses (ä»“åº“)
  â”œâ”€â†’ inventory (åº“å­˜)
  â””â”€â†’ inventory_transactions (æµæ°´)
\`\`\`

### yyc3_hr æ ¸å¿ƒå…³ç³»

\`\`\`
hr_employees (å‘˜å·¥)
  â”œâ”€â†’ hr_departments (éƒ¨é—¨)
  â”œâ”€â†’ hr_attendance (è€ƒå‹¤)
  â”œâ”€â†’ hr_leaves (è¯·å‡)
  â”œâ”€â†’ hr_salaries (è–ªèµ„)
  â”œâ”€â†’ hr_performance (ç»©æ•ˆ)
  â””â”€â†’ hr_training_participants (åŸ¹è®­)

hr_trainings (åŸ¹è®­)
  â””â”€â†’ hr_training_participants (å‚ä¸è€…)
\`\`\`

### è·¨åº“å…³è”

\`\`\`
yyc3_yy.users.id â†’ yyc3_hr.hr_employees.user_id
yyc3_yy.users.id â†’ yyc3_audit.audit_logs.user_id
yyc3_yy.users.id â†’ yyc3_audit.audit_data_changes.user_id
\`\`\`

**æ³¨æ„**: è·¨åº“å…³è”ä½¿ç”¨åº”ç”¨å±‚JOINï¼Œä¸ä½¿ç”¨ç‰©ç†å¤–é”®ã€‚

---

## æ•°æ®è¿ç§»

### åˆå§‹åŒ–è„šæœ¬

#### 1. åˆ›å»ºæ•°æ®åº“

\`\`\`sql
-- åˆ›å»º yyc3_yy æ•°æ®åº“
CREATE DATABASE IF NOT EXISTS `yyc3_yy` 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_unicode_ci;

-- åˆ›å»º yyc3_hr æ•°æ®åº“
CREATE DATABASE IF NOT EXISTS `yyc3_hr` 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_unicode_ci;

-- åˆ›å»º yyc3_audit æ•°æ®åº“
CREATE DATABASE IF NOT EXISTS `yyc3_audit` 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_unicode_ci;
\`\`\`

#### 2. åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ

\`\`\`sql
-- åˆ›å»ºç”¨æˆ·
CREATE USER IF NOT EXISTS 'devuser'@'localhost' IDENTIFIED BY 'devpassword';
CREATE USER IF NOT EXISTS 'hr_admin'@'localhost' IDENTIFIED BY 'secure_hr_pass';
CREATE USER IF NOT EXISTS 'audit_user'@'localhost' IDENTIFIED BY 'secure_audit_pass';

-- æˆæƒ yyc3_yy
GRANT ALL PRIVILEGES ON yyc3_yy.* TO 'devuser'@'localhost';

-- æˆæƒ yyc3_hr
GRANT ALL PRIVILEGES ON yyc3_hr.* TO 'hr_admin'@'localhost';

-- æˆæƒ yyc3_audit
GRANT ALL PRIVILEGES ON yyc3_audit.* TO 'audit_user'@'localhost';

FLUSH PRIVILEGES;
\`\`\`

#### 3. å¯¼å…¥è¡¨ç»“æ„

\`\`\`bash
# å¯¼å…¥ yyc3_yy è¡¨ç»“æ„
mysql -u devuser -p yyc3_yy < scripts/sql/yyc3_yy_schema.sql

# å¯¼å…¥ yyc3_hr è¡¨ç»“æ„
mysql -u hr_admin -p yyc3_hr < scripts/sql/yyc3_hr_schema.sql

# å¯¼å…¥ yyc3_audit è¡¨ç»“æ„
mysql -u audit_user -p yyc3_audit < scripts/sql/yyc3_audit_schema.sql
\`\`\`

### åˆå§‹åŒ–æ•°æ®

#### æ’å…¥é»˜è®¤ç®¡ç†å‘˜

\`\`\`sql
USE yyc3_yy;

-- æ’å…¥é»˜è®¤ç®¡ç†å‘˜ (å¯†ç : admin123ï¼Œéœ€ä½¿ç”¨bcryptåŠ å¯†)
INSERT INTO users (username, password, name, phone, email, role, status)
VALUES ('admin', '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy', 'ç³»ç»Ÿç®¡ç†å‘˜', '13800138000', 'admin@ktv.com', 'admin', 'active');

-- æ’å…¥ä¼šå‘˜ç­‰çº§
INSERT INTO member_levels (name, code, discount_rate, min_consumption, points_rate, sort_order)
VALUES 
  ('æ™®é€šä¼šå‘˜', 'NORMAL', 100.00, 0.00, 1.00, 1),
  ('é“¶å¡ä¼šå‘˜', 'SILVER', 95.00, 1000.00, 1.20, 2),
  ('é‡‘å¡ä¼šå‘˜', 'GOLD', 90.00, 5000.00, 1.50, 3),
  ('é’»çŸ³ä¼šå‘˜', 'DIAMOND', 85.00, 10000.00, 2.00, 4),
  ('è‡³å°Šä¼šå‘˜', 'PLATINUM', 80.00, 50000.00, 3.00, 5);

-- æ’å…¥å•†å“åˆ†ç±»
INSERT INTO categories (name, code, sort_order)
VALUES
  ('é…’æ°´', 'DRINKS', 1),
  ('å°é£Ÿ', 'SNACKS', 2),
  ('æœç›˜', 'FRUITS', 3),
  ('å¥—é¤', 'PACKAGES', 4);

-- æ’å…¥ä»“åº“
INSERT INTO warehouses (code, name, type, status)
VALUES ('WH001', 'ä¸»ä»“åº“', 'main', 'active');
\`\`\`

#### æ’å…¥æµ‹è¯•æ•°æ®

\`\`\`sql
-- æ’å…¥æµ‹è¯•å•†å“
INSERT INTO products (barcode, name, category_id, unit, original_price, sale_price, member_price, cost, status)
SELECT 
  CONCAT('BAR', LPAD(n, 6, '0')),
  CONCAT('å•†å“', n),
  (n % 4) + 1,
  'ä¸ª',
  ROUND(20 + RAND() * 80, 2),
  ROUND(15 + RAND() * 60, 2),
  ROUND(12 + RAND() * 50, 2),
  ROUND(8 + RAND() * 30, 2),
  'active'
FROM (
  SELECT @row := @row + 1 AS n
  FROM (SELECT 0 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3) t1,
       (SELECT 0 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3) t2,
       (SELECT 0 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3) t3,
       (SELECT @row := 0) t4
  LIMIT 100
) numbers;

-- æ’å…¥åŒ…å¢
INSERT INTO rooms (number, name, type, area, floor, capacity, hourly_rate, member_hourly_rate, status)
VALUES
  ('A001', 'è±ªååŒ…å¢A', 'vip', 'AåŒº', 1, 8, 200.00, 180.00, 'available'),
  ('A002', 'è±ªååŒ…å¢B', 'vip', 'AåŒº', 1, 8, 200.00, 180.00, 'available'),
  ('B001', 'æ ‡å‡†åŒ…å¢A', 'medium', 'BåŒº', 2, 6, 150.00, 135.00, 'available'),
  ('B002', 'æ ‡å‡†åŒ…å¢B', 'medium', 'BåŒº', 2, 6, 150.00, 135.00, 'available'),
  ('C001', 'å°åŒ…å¢A', 'small', 'CåŒº', 3, 4, 100.00, 90.00, 'available');
\`\`\`

### æ•°æ®è¿ç§»å·¥å…·

\`\`\`bash
# åˆ›å»ºè¿ç§»è„šæœ¬ç›®å½•
mkdir -p scripts/migrations

# è¿ç§»è„šæœ¬å‘½åè§„èŒƒï¼šYYYYMMDDHHMMSS_description.sql
# ä¾‹å¦‚ï¼š20250118120000_create_users_table.sql
\`\`\`

---

## æ€§èƒ½ä¼˜åŒ–

### 1. æŸ¥è¯¢ä¼˜åŒ–

#### ä½¿ç”¨ç´¢å¼•

\`\`\`sql
-- âŒ é¿å…ï¼šå…¨è¡¨æ‰«æ
SELECT * FROM orders WHERE DATE(created_at) = '2025-01-18';

-- âœ… æ¨èï¼šä½¿ç”¨ç´¢å¼•
SELECT * FROM orders 
WHERE created_at >= '2025-01-18 00:00:00' 
  AND created_at < '2025-01-19 00:00:00';
\`\`\`

#### é¿å…SELECT *

\`\`\`sql
-- âŒ é¿å…
SELECT * FROM products WHERE status = 'active';

-- âœ… æ¨è
SELECT id, name, sale_price, stock FROM products WHERE status = 'active';
\`\`\`

#### ä½¿ç”¨LIMITåˆ†é¡µ

\`\`\`sql
-- âœ… åˆ†é¡µæŸ¥è¯¢
SELECT id, name, phone FROM members 
WHERE status = 'active'
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
\`\`\`

### 2. è¡¨ç»“æ„ä¼˜åŒ–

#### å‚ç›´åˆ†è¡¨

\`\`\`sql
-- å°†å¤§å­—æ®µåˆ†ç¦»åˆ°æ‰©å±•è¡¨
CREATE TABLE products_extended (
  product_id BIGINT UNSIGNED NOT NULL,
  description TEXT,
  specifications JSON,
  images JSON,
  PRIMARY KEY (product_id),
  CONSTRAINT fk_extended_product FOREIGN KEY (product_id) REFERENCES products(id)
) ENGINE=InnoDB;
\`\`\`

#### è¯»å†™åˆ†ç¦»

\`\`\`ini
# ä¸»åº“ï¼šå†™æ“ä½œ
MASTER_DB_HOST=master.db.local

# ä»åº“ï¼šè¯»æ“ä½œ
SLAVE_DB_HOST=slave.db.local
\`\`\`

### 3. ç¼“å­˜ç­–ç•¥

#### Redisç¼“å­˜çƒ­ç‚¹æ•°æ®

\`\`\`typescript
// ç¼“å­˜å•†å“ä¿¡æ¯
const cacheKey = `product:${productId}`
await redis.setex(cacheKey, 3600, JSON.stringify(product))

// ç¼“å­˜åŒ…å¢çŠ¶æ€
const roomCacheKey = `rooms:status`
await redis.setex(roomCacheKey, 60, JSON.stringify(roomsStatus))
\`\`\`

### 4. åˆ†åŒºè¡¨

#### æŒ‰æ—¶é—´åˆ†åŒºï¼ˆè®¢å•è¡¨ï¼‰

\`\`\`sql
-- åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE orders_partitioned (
  -- å­—æ®µå®šä¹‰åŒordersè¡¨
  ...
) ENGINE=InnoDB
PARTITION BY RANGE (YEAR(created_at)) (
  PARTITION p2023 VALUES LESS THAN (2024),
  PARTITION p2024 VALUES LESS THAN (2025),
  PARTITION p2025 VALUES LESS THAN (2026),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
\`\`\`

### 5. å®šæœŸç»´æŠ¤

\`\`\`sql
-- åˆ†æè¡¨
ANALYZE TABLE orders, order_items, products;

-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE audit_logs;

-- æ£€æŸ¥ç¢ç‰‡
SELECT 
  TABLE_NAME,
  DATA_FREE / 1024 / 1024 AS data_free_mb
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'yyc3_yy'
  AND DATA_FREE > 0
ORDER BY DATA_FREE DESC;
\`\`\`

---

## å¤‡ä»½ç­–ç•¥

### 1. å…¨é‡å¤‡ä»½

\`\`\`bash
#!/bin/bash
# æ¯æ—¥å…¨é‡å¤‡ä»½è„šæœ¬

BACKUP_DIR="/data/backups/mysql"
DATE=$(date +%Y%m%d)

# å¤‡ä»½ yyc3_yy
mysqldump -u devuser -p'devpassword' \
  --single-transaction \
  --routines \
  --triggers \
  yyc3_yy > ${BACKUP_DIR}/yyc3_yy_${DATE}.sql

# å¤‡ä»½ yyc3_hr
mysqldump -u hr_admin -p'secure_hr_pass' \
  --single-transaction \
  yyc3_hr > ${BACKUP_DIR}/yyc3_hr_${DATE}.sql

# å¤‡ä»½ yyc3_audit
mysqldump -u audit_user -p'secure_audit_pass' \
  --single-transaction \
  yyc3_audit > ${BACKUP_DIR}/yyc3_audit_${DATE}.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip ${BACKUP_DIR}/*_${DATE}.sql

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find ${BACKUP_DIR} -name "*.sql.gz" -mtime +7 -delete
\`\`\`

### 2. å¢é‡å¤‡ä»½

\`\`\`bash
# å¯ç”¨binlog
[mysqld]
server-id=1
log_bin=/var/log/mysql/mysql-bin.log
binlog_format=ROW
expire_logs_days=7

# å¤‡ä»½binlog
mysqlbinlog mysql-bin.000001 > binlog_backup.sql
\`\`\`

### 3. å¤‡ä»½æ¢å¤

\`\`\`bash
# æ¢å¤å…¨é‡å¤‡ä»½
gunzip < yyc3_yy_20250118.sql.gz | mysql -u devuser -p yyc3_yy

# æ¢å¤å¢é‡å¤‡ä»½
mysqlbinlog binlog_backup.sql | mysql -u devuser -p yyc3_yy
\`\`\`

### 4. äº‘å¤‡ä»½

\`\`\`bash
# ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS
ossutil cp ${BACKUP_DIR}/yyc3_yy_${DATE}.sql.gz \
  oss://ktv-backups/mysql/

# ä¸Šä¼ åˆ°AWS S3
aws s3 cp ${BACKUP_DIR}/yyc3_yy_${DATE}.sql.gz \
  s3://ktv-backups/mysql/
\`\`\`

---

## ç›‘æ§ä¸å‘Šè­¦

### 1. æ€§èƒ½ç›‘æ§

\`\`\`sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log 
WHERE query_time > 1
ORDER BY start_time DESC 
LIMIT 10;

-- æŸ¥çœ‹è¡¨å¤§å°
SELECT 
  TABLE_NAME,
  ROUND((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) AS size_mb,
  TABLE_ROWS
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'yyc3_yy'
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
  TABLE_NAME,
  INDEX_NAME,
  SEQ_IN_INDEX,
  COLUMN_NAME
FROM information_schema.STATISTICS
WHERE TABLE_SCHEMA = 'yyc3_yy'
ORDER BY TABLE_NAME, INDEX_NAME, SEQ_IN_INDEX;
\`\`\`

### 2. è¿æ¥ç›‘æ§

\`\`\`sql
-- æŸ¥çœ‹å½“å‰è¿æ¥
SHOW PROCESSLIST;

-- æŸ¥çœ‹è¿æ¥æ•°ç»Ÿè®¡
SHOW STATUS LIKE 'Threads_connected';
SHOW STATUS LIKE 'Max_used_connections';
SHOW VARIABLES LIKE 'max_connections';
\`\`\`

### 3. ç£ç›˜ç›‘æ§

\`\`\`bash
# æŸ¥çœ‹æ•°æ®åº“ç›®å½•å¤§å°
du -sh /var/lib/mysql/*

# æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h
\`\`\`

---

## æ•°æ®å­—å…¸

å®Œæ•´çš„æ•°æ®å­—å…¸å·²ç”Ÿæˆï¼ŒåŒ…å«æ‰€æœ‰è¡¨çš„å­—æ®µè¯´æ˜ã€ç±»å‹ã€çº¦æŸç­‰ä¿¡æ¯ã€‚

å¯é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢å¯¼å‡ºï¼š

\`\`\`sql
SELECT 
  TABLE_NAME AS 'è¡¨å',
  COLUMN_NAME AS 'å­—æ®µå',
  COLUMN_TYPE AS 'ç±»å‹',
  IS_NULLABLE AS 'å…è®¸ç©º',
  COLUMN_KEY AS 'é”®',
  COLUMN_DEFAULT AS 'é»˜è®¤å€¼',
  COLUMN_COMMENT AS 'è¯´æ˜'
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = 'yyc3_yy'
ORDER BY TABLE_NAME, ORDINAL_POSITION;
\`\`\`

---

## é™„å½•

### å¸¸ç”¨SQLç¤ºä¾‹

#### 1. ç»Ÿè®¡æŠ¥è¡¨æŸ¥è¯¢

\`\`\`sql
-- ä»Šæ—¥é”€å”®ç»Ÿè®¡
SELECT 
  COUNT(*) AS order_count,
  SUM(total) AS total_sales,
  AVG(total) AS avg_order_value
FROM orders
WHERE DATE(created_at) = CURDATE()
  AND status = 'completed';

-- å•†å“é”€å”®æ’è¡Œ
SELECT 
  p.id,
  p.name,
  SUM(oi.quantity) AS total_quantity,
  SUM(oi.subtotal) AS total_sales
FROM order_items oi
JOIN products p ON oi.product_id = p.id
JOIN orders o ON oi.order_id = o.id
WHERE o.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
  AND o.status = 'completed'
GROUP BY p.id, p.name
ORDER BY total_sales DESC
LIMIT 10;
\`\`\`

#### 2. åº“å­˜é¢„è­¦æŸ¥è¯¢

\`\`\`sql
-- ä½åº“å­˜å•†å“
SELECT 
  p.id,
  p.name,
  i.quantity,
  p.min_stock,
  (p.min_stock - i.quantity) AS shortage
FROM products p
JOIN inventory i ON p.id = i.product_id
WHERE i.quantity < p.min_stock
  AND p.status = 'active'
ORDER BY shortage DESC;
\`\`\`

#### 3. ä¼šå‘˜åˆ†ææŸ¥è¯¢

\`\`\`sql
-- æ´»è·ƒä¼šå‘˜ç»Ÿè®¡
SELECT 
  ml.name AS level_name,
  COUNT(*) AS member_count,
  SUM(m.total_consumption) AS total_consumption,
  AVG(m.avg_order_value) AS avg_order_value
FROM members m
JOIN member_levels ml ON m.level_id = ml.id
WHERE m.status = 'active'
  AND m.last_visit >= DATE_SUB(NOW(), INTERVAL 90 DAY)
GROUP BY ml.id, ml.name
ORDER BY ml.sort_order;
\`\`\`

---

## ç‰ˆæœ¬å†å²

### v1.0.0 (2025-01-18)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®Œæˆä¸‰ä¸ªæ ¸å¿ƒæ•°æ®åº“è®¾è®¡
- åŒ…å«å®Œæ•´çš„è¡¨ç»“æ„ã€ç´¢å¼•å’Œå…³ç³»

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰æ•°æ®åº“ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»ï¼š

- ğŸ“§ é‚®ä»¶: db-support@yyc3.com
- ğŸ“– æ–‡æ¡£: [docs/INDEX.md](./INDEX.md)
- ğŸ’¬ åé¦ˆ: è¯·åœ¨é¡¹ç›®Issueä¸­æäº¤

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-18  
**ç»´æŠ¤è€…**: æ•°æ®åº“å›¢é˜Ÿ  
**å®¡æ ¸çŠ¶æ€**: âœ… å·²å®Œæˆ

Â© 2025 å¯æ™ºç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸

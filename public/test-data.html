<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å•†å“æ•°æ®æµ‹è¯•é¡µé¢</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #2c3e50;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #2980b9;
    }
    .results {
      margin-top: 20px;
    }
    .success {
      color: #27ae60;
      font-weight: bold;
    }
    .error {
      color: #e74c3c;
      font-weight: bold;
    }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .steps {
      background: #e8f4fd;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .steps li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ›’ å•†å“æ•°æ®æµ‹è¯•é¡µé¢</h1>
    
    <div class="steps">
      <h3>æµ‹è¯•æ­¥éª¤ï¼š</h3>
      <ol>
        <li>1. ç‚¹å‡»æŒ‰é’®æµ‹è¯•localStorageä¸­çš„å•†å“æ•°æ®</li>
        <li>2. æ¸…é™¤ç¼“å­˜åé‡æ–°åŠ è½½åº”ç”¨æŸ¥çœ‹å•†å“åˆ—è¡¨</li>
        <li>3. è®¿é—® http://localhost:3555/dashboard/products/list éªŒè¯å•†å“æ˜¾ç¤º</li>
      </ol>
    </div>
    
    <button id="testButton">ğŸ” æµ‹è¯•å•†å“æ•°æ®åŠ è½½</button>
    <button id="clearButton">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åˆå§‹åŒ–</button>
    <button id="viewAppButton">ğŸš€ æŸ¥çœ‹å•†å“åˆ—è¡¨é¡µé¢</button>
    
    <div class="results" id="results">
      <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
    </div>
  </div>

  <script>
    // æ¨¡æ‹Ÿstorageå·¥å…·å‡½æ•°
    const storage = {
      get(key, defaultValue = null) {
        const value = localStorage.getItem(key);
        return value ? JSON.parse(value) : defaultValue;
      },
      set(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      },
      remove(key) {
        localStorage.removeItem(key);
      },
      clear() {
        localStorage.clear();
      }
    };

    // åˆå§‹åŒ–æ•°æ®å‡½æ•°
    function initializeData() {
      // å¯¼å…¥åˆ†ç±»æ•°æ®
      const categories = [
        { "id": "snack", "name": "å°åƒ", "displayOrder": 1, "isDisplay": true },
        { "id": "drink", "name": "é¥®æ–™", "displayOrder": 2, "isDisplay": true },
        { "id": "tobacco", "name": "çƒŸé…’", "displayOrder": 3, "isDisplay": true },
        { "id": "compensation", "name": "å®¢èµ”ç‰©å“", "displayOrder": 4, "isDisplay": true },
        { "id": "other", "name": "å…¶ä»–", "displayOrder": 5, "isDisplay": true }
      ];
      storage.set("db_categories", categories);
      
      // å¯¼å…¥å•†å“æ•°æ® - æ·»åŠ 91æ¡å•†å“
      const products = [
        { "id": "PROD17628068887968vopt4luh", "name": "ä¼šå‘˜å¡æ³¡é¢", "alias": "ä¼šå‘˜å¡æ³¡é¢", "barcode": [], "categoryId": "snack", "unit": "æ¡¶", "originalPrice": 38, "price": 38, "memberPrice": 38, "stock": 100, "minStock": 10, "costPrice": 0, "images": [], "flavors": [], "isGift": false, "allowDiscount": true, "isSale": true, "isRecommend": false, "isLowConsumption": false, "displayOrder": 0, "storeId": "qizhi", "createdAt": "2025-11-10T20:34:48.796Z", "updatedAt": "2025-11-10T20:34:48.797Z" },
        { "id": "PROD17628068887973a8i7oo03", "name": "ç°é‡‘æ³¡é¢", "alias": "ç°é‡‘æ³¡é¢", "barcode": [], "categoryId": "snack", "unit": "æ¡¶", "originalPrice": 10, "price": 10, "memberPrice": 38, "stock": 100, "minStock": 10, "costPrice": 0, "images": [], "flavors": [], "isGift": false, "allowDiscount": true, "isSale": true, "isRecommend": false, "isLowConsumption": false, "displayOrder": 0, "storeId": "qizhi", "createdAt": "2025-11-10T20:34:48.797Z", "updatedAt": "2025-11-10T20:34:48.797Z" },
        { "id": "PROD17628068887971kdc0xh3d", "name": "é’å²›", "alias": "é’å²›", "barcode": [], "categoryId": "other", "unit": "å¬", "originalPrice": 45, "price": 45, "memberPrice": 45, "stock": 100, "minStock": 10, "costPrice": 0, "images": [], "flavors": [], "isGift": false, "allowDiscount": true, "isSale": true, "isRecommend": false, "isLowConsumption": false, "displayOrder": 0, "storeId": "qizhi", "createdAt": "2025-11-10T20:34:48.797Z", "updatedAt": "2025-11-10T20:34:48.797Z" },
        { "id": "PROD1762806888797o331l2ipu", "name": "é»‘æ¡ƒAé¦™æ§Ÿ", "alias": "é»‘æ¡ƒAé¦™æ§Ÿ", "barcode": [], "categoryId": "drink", "unit": "ç“¶", "originalPrice": 299, "price": 299, "memberPrice": 299, "stock": 100, "minStock": 10, "costPrice": 0, "images": [], "flavors": [], "isGift": false, "allowDiscount": true, "isSale": true, "isRecommend": false, "isLowConsumption": false, "displayOrder": 0, "storeId": "qizhi", "createdAt": "2025-11-10T20:34:48.797Z", "updatedAt": "2025-11-10T20:34:48.797Z" },
        { "id": "PROD1762806888797asymjhr47", "name": "è…ç«¹", "alias": "è…ç«¹", "barcode": [], "categoryId": "other", "unit": "ç›˜", "originalPrice": 48, "price": 48, "memberPrice": 48, "stock": 100, "minStock": 10, "costPrice": 0, "images": [], "flavors": [], "isGift": false, "allowDiscount": true, "isSale": true, "isRecommend": false, "isLowConsumption": false, "displayOrder": 0, "storeId": "qizhi", "createdAt": "2025-11-10T20:34:48.797Z", "updatedAt": "2025-11-10T20:34:48.797Z" }
      ];
      
      // æ·»åŠ æ›´å¤šå•†å“
      for (let i = 6; i <= 91; i++) {
        products.push({
          id: `PROD_${Date.now()}_${i}`,
          name: `å•†å“${i}`,
          alias: `å•†å“${i}`,
          barcode: [],
          categoryId: i % 5 === 0 ? "drink" : (i % 5 === 1 ? "snack" : (i % 5 === 2 ? "tobacco" : (i % 5 === 3 ? "compensation" : "other"))),
          unit: "ä¸ª",
          originalPrice: 20 + i,
          price: 18 + i,
          memberPrice: 16 + i,
          stock: 100,
          minStock: 10,
          costPrice: 10 + i,
          images: [],
          flavors: [],
          isGift: false,
          allowDiscount: true,
          isSale: true,
          isRecommend: i % 10 === 0,
          isLowConsumption: false,
          displayOrder: 0,
          storeId: "qizhi",
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        });
      }
      
      storage.set("db_products", products);
      return { categories, products };
    }

    // æµ‹è¯•æ•°æ®å‡½æ•°
    function testData() {
      const results = document.getElementById('results');
      
      try {
        // è·å–åˆ†ç±»æ•°æ®
        const categories = storage.get('db_categories', []);
        const products = storage.get('db_products', []);
        
        let html = `
          <h2 class="success">âœ… æ•°æ®åŠ è½½æµ‹è¯•ç»“æœ</h2>
          <p>åˆ†ç±»æ•°é‡: <strong>${categories.length}</strong> ä¸ª</p>
          <p>å•†å“æ•°é‡: <strong>${products.length}</strong> ä»¶</p>
        `;
        
        if (products.length === 0) {
          html += `
            <p class="error">âŒ æœªæ‰¾åˆ°å•†å“æ•°æ®ï¼è¯·ç‚¹å‡»"æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åˆå§‹åŒ–"æŒ‰é’®ã€‚</p>
          `;
        } else {
          // æ˜¾ç¤ºå‰3æ¡å•†å“
          html += `
            <h3>å•†å“ç¤ºä¾‹ (<strong>å‰3æ¡</strong>):</h3>
            <pre>${JSON.stringify(products.slice(0, 3), null, 2)}</pre>
          `;
          
          // ç»Ÿè®¡å„åˆ†ç±»å•†å“æ•°é‡
          html += `
            <h3>åˆ†ç±»ç»Ÿè®¡:</h3>
            <pre>`;
          categories.forEach(cat => {
            const count = products.filter(p => p.categoryId === cat.id).length;
            html += `â€¢ ${cat.name}: ${count} ä»¶å•†å“\n`;
          });
          html += `</pre>`;
          
          html += `
            <p class="success">âœ… æ•°æ®åŠ è½½æˆåŠŸï¼ç°åœ¨å¯ä»¥è®¿é—®å•†å“åˆ—è¡¨é¡µé¢æŸ¥çœ‹å®Œæ•´æ•°æ®ã€‚</p>
          `;
        }
        
        results.innerHTML = html;
      } catch (error) {
        results.innerHTML = `
          <h2 class="error">âŒ æµ‹è¯•å¤±è´¥</h2>
          <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
        `;
      }
    }

    // æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åˆå§‹åŒ–
    function clearAndInitialize() {
      const results = document.getElementById('results');
      
      try {
        // æ¸…é™¤ç›¸å…³ç¼“å­˜
        localStorage.removeItem('db_products');
        localStorage.removeItem('db_categories');
        localStorage.removeItem('db_members');
        
        // é‡æ–°åˆå§‹åŒ–æ•°æ®
        const { categories, products } = initializeData();
        
        results.innerHTML = `
          <h2 class="success">âœ… ç¼“å­˜æ¸…é™¤å¹¶é‡æ–°åˆå§‹åŒ–æˆåŠŸï¼</h2>
          <p>å·²å¯¼å…¥ <strong>${categories.length}</strong> ä¸ªåˆ†ç±»æ•°æ®</p>
          <p>å·²å¯¼å…¥ <strong>${products.length}</strong> ä»¶å•†å“æ•°æ®</p>
          <p>è¯·åˆ·æ–°åº”ç”¨é¡µé¢æŸ¥çœ‹å•†å“åˆ—è¡¨ã€‚</p>
        `;
        
        console.log('âœ… æ•°æ®åˆå§‹åŒ–å®Œæˆ:', { categories: categories.length, products: products.length });
      } catch (error) {
        results.innerHTML = `
          <h2 class="error">âŒ åˆå§‹åŒ–å¤±è´¥</h2>
          <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
        `;
      }
    }

    // äº‹ä»¶ç›‘å¬
    document.getElementById('testButton').addEventListener('click', testData);
    document.getElementById('clearButton').addEventListener('click', clearAndInitialize);
    document.getElementById('viewAppButton').addEventListener('click', () => {
      window.location.href = 'http://localhost:3555/dashboard/products/list';
    });
  </script>
</body>
</html>
# K6 æ€§èƒ½æµ‹è¯•å¥—ä»¶

> Phase 5.2 - æ€§èƒ½ä¸å‹åŠ›æµ‹è¯•  
> ä½¿ç”¨ K6 æ¡†æ¶è¿›è¡Œè´Ÿè½½æµ‹è¯•å’Œæ€§èƒ½åˆ†æ

---

## ğŸ“‹ æµ‹è¯•æ¸…å•

### å·²åˆ›å»ºçš„æµ‹è¯•è„šæœ¬

| æµ‹è¯•æ–‡ä»¶                  | æµ‹è¯•ç›®æ ‡                 | è™šæ‹Ÿç”¨æˆ·æ•° | æŒç»­æ—¶é—´ | ä¼˜å…ˆçº§ |
| ------------------------- | ------------------------ | ---------- | -------- | ------ |
| `api-performance.js`      | API ç«¯ç‚¹å“åº”æ—¶é—´å’Œååé‡ | 20â†’100     | 5 åˆ†é’Ÿ   | ğŸ”´ é«˜  |
| `db-performance.js`       | æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½å’Œè¿æ¥æ±    | 50â†’100     | 2.5 åˆ†é’Ÿ | ğŸ”´ é«˜  |
| `concurrent-users.js`     | å¹¶å‘ç”¨æˆ·å®Œæ•´ä¼šè¯æµç¨‹     | 100â†’1000   | 13 åˆ†é’Ÿ  | ğŸ”´ é«˜  |
| `cache-performance.js`    | Redis ç¼“å­˜å‘½ä¸­ç‡å’Œæ€§èƒ½   | 50â†’100     | 3 åˆ†é’Ÿ   | ğŸŸ¡ ä¸­  |
| `payment-stress.js`       | æ”¯ä»˜ç½‘å…³é«˜å¹¶å‘å‹åŠ›       | 50â†’500     | 9 åˆ†é’Ÿ   | ğŸ”´ é«˜  |
| `upload-performance.js`   | æ–‡ä»¶ä¸Šä¼ æ€§èƒ½å’Œç¨³å®šæ€§     | 5â†’35       | 5 åˆ†é’Ÿ   | ğŸŸ¢ ä½  |
| `websocket-test.js`       | WebSocket å®æ—¶é€šä¿¡æ€§èƒ½   | 100â†’1000   | 5 åˆ†é’Ÿ   | ğŸŸ¡ ä¸­  |
| `comprehensive-stress.js` | ç»¼åˆç”Ÿäº§ç¯å¢ƒå‹åŠ›æ¨¡æ‹Ÿ     | 500â†’2000   | 10 åˆ†é’Ÿ  | ğŸ”´ é«˜  |

**æ€»è®¡**: 8 ä¸ª K6 æ€§èƒ½æµ‹è¯•è„šæœ¬

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… K6

```bash
# macOS
brew install k6

# Linux (Debian/Ubuntu)
sudo gpg -k
sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6

# Windows (Chocolatey)
choco install k6

# Docker
docker pull grafana/k6
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `performance/config.env`:

```bash
# æµ‹è¯•ç›®æ ‡URL
export BASE_URL="http://localhost:3000"
export WS_URL="ws://localhost:3000/ws"

# è®¤è¯ä»¤ç‰Œ (å¯é€‰)
export API_TOKEN="your-test-token-here"

# æ€§èƒ½é˜ˆå€¼
export MAX_RESPONSE_TIME=200
export MIN_SUCCESS_RATE=0.99
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./performance/run-performance-tests.sh all

# è¿è¡Œå•ä¸ªæµ‹è¯•
./performance/run-performance-tests.sh api          # APIæ€§èƒ½æµ‹è¯•
./performance/run-performance-tests.sh db           # æ•°æ®åº“æ€§èƒ½æµ‹è¯•
./performance/run-performance-tests.sh concurrent   # å¹¶å‘ç”¨æˆ·æµ‹è¯•
./performance/run-performance-tests.sh cache        # ç¼“å­˜æ€§èƒ½æµ‹è¯•
./performance/run-performance-tests.sh payment      # æ”¯ä»˜å‹åŠ›æµ‹è¯•
./performance/run-performance-tests.sh upload       # æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
./performance/run-performance-tests.sh websocket    # WebSocketæµ‹è¯•
./performance/run-performance-tests.sh stress       # ç»¼åˆå‹åŠ›æµ‹è¯•
```

### 4. æŸ¥çœ‹æµ‹è¯•ç»“æœ

```bash
# æŸ¥çœ‹JSONç»“æœ
cat performance/results/*-summary.json | jq

# æŸ¥çœ‹HTMLæŠ¥å‘Š (å¦‚æœç”Ÿæˆ)
open performance/results/comprehensive-stress-report.html
```

---

## ğŸ“Š æµ‹è¯•åœºæ™¯è¯¦è§£

### 1. API æ€§èƒ½æµ‹è¯• (`api-performance.js`)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ API ç«¯ç‚¹å“åº”æ—¶é—´å’Œååé‡

**æµ‹è¯•åœºæ™¯**:

- å•†å“åˆ—è¡¨æŸ¥è¯¢ (ç›®æ ‡: <200ms)
- å•†å“æœç´¢ (ç›®æ ‡: <300ms)
- è®¢å•åˆ—è¡¨æŸ¥è¯¢ (ç›®æ ‡: <200ms)
- ä¼šå‘˜åˆ—è¡¨æŸ¥è¯¢ (ç›®æ ‡: <200ms)
- ç»Ÿè®¡æ•°æ®æŸ¥è¯¢ (ç›®æ ‡: <500ms)

**è´Ÿè½½æ¨¡å¼**:

```
é¢„çƒ­: 30ç§’ â†’ 20ç”¨æˆ·
å¢é•¿: 1åˆ†é’Ÿ â†’ 50ç”¨æˆ·
å‹åŠ›: 2åˆ†é’Ÿ â†’ 100ç”¨æˆ·
é™ä½: 1åˆ†é’Ÿ â†’ 50ç”¨æˆ·
å†·å´: 30ç§’ â†’ 0ç”¨æˆ·
```

**å…³é”®æŒ‡æ ‡**:

- P95 å“åº”æ—¶é—´ < 200ms
- é”™è¯¯ç‡ < 1%
- ä¸šåŠ¡é”™è¯¯ç‡ < 5%
- P99 API å“åº” < 500ms

---

### 2. æ•°æ®åº“æ€§èƒ½æµ‹è¯• (`db-performance.js`)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½å’Œè¿æ¥æ± ç®¡ç†

**æµ‹è¯•åœºæ™¯**:

- **ç®€å•æŸ¥è¯¢** (é«˜å¹¶å‘): å•è¡¨æŸ¥è¯¢,50â†’100 VUs
- **å¤æ‚æŸ¥è¯¢** (ä¸­ç­‰å¹¶å‘): JOIN æŸ¥è¯¢ã€èšåˆç»Ÿè®¡,20â†’50 VUs
- **æ‰¹é‡æ’å…¥** (ä½å¹¶å‘): æ‰¹é‡åˆ›å»ºè®¢å•,10 VUs

**å…³é”®æŒ‡æ ‡**:

- P95 æŸ¥è¯¢æ—¶é—´ < 100ms
- P99 æŸ¥è¯¢æ—¶é—´ < 200ms
- æ…¢æŸ¥è¯¢ç‡ < 5%
- æ•°æ®åº“é”™è¯¯ç‡ < 1%

---

### 3. å¹¶å‘ç”¨æˆ·æµ‹è¯• (`concurrent-users.js`)

**æµ‹è¯•ç›®æ ‡**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·å¹¶å‘è®¿é—®å®Œæ•´æµç¨‹

**ç”¨æˆ·æ—…ç¨‹**:

1. ç™»å½•è®¤è¯
2. æµè§ˆå•†å“åˆ—è¡¨ã€æœç´¢ã€æŸ¥çœ‹è¯¦æƒ…
3. æ·»åŠ è´­ç‰©è½¦ã€æŸ¥çœ‹è´­ç‰©è½¦
4. åˆ›å»ºè®¢å•
5. æ‰§è¡Œæ”¯ä»˜
6. æŸ¥çœ‹è®¢å•

**è´Ÿè½½çº§åˆ«**:

- **ä½è´Ÿè½½**: 100 ä¸ªå¹¶å‘ç”¨æˆ· (2 åˆ†é’Ÿ)
- **ä¸­è´Ÿè½½**: 500 ä¸ªå¹¶å‘ç”¨æˆ· (5 åˆ†é’Ÿ,3 åˆ†é’Ÿåå¼€å§‹)
- **é«˜è´Ÿè½½**: 1000 ä¸ªå¹¶å‘ç”¨æˆ· (7 åˆ†é’Ÿ,8 åˆ†é’Ÿåå¼€å§‹)

**å…³é”®æŒ‡æ ‡**:

- ç™»å½•æˆåŠŸç‡ > 99%
- ç»“è´¦æˆåŠŸç‡ > 95%
- P95 å“åº”æ—¶é—´ < 300ms
- P99 å“åº”æ—¶é—´ < 1000ms

---

### 4. ç¼“å­˜æ€§èƒ½æµ‹è¯• (`cache-performance.js`)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ Redis ç¼“å­˜å‘½ä¸­ç‡å’Œæ€§èƒ½æå‡

**æµ‹è¯•ç­–ç•¥**:

- 80%è¯·æ±‚è®¿é—®çƒ­é—¨å•†å“ (åº”å‘½ä¸­ç¼“å­˜)
- 20%è¯·æ±‚è®¿é—®æ™®é€šå•†å“ (å¯èƒ½æœªç¼“å­˜)

**å…³é”®æŒ‡æ ‡**:

- ç¼“å­˜å‘½ä¸­ç‡ > 80%
- ç¼“å­˜å“åº” < 50ms
- æ•°æ®åº“å“åº” < 200ms
- æ€§èƒ½æå‡å€æ•°

---

### 5. æ”¯ä»˜å‹åŠ›æµ‹è¯• (`payment-stress.js`)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯æ”¯ä»˜ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹çš„ç¨³å®šæ€§

**æµ‹è¯•åœºæ™¯**:

- **æ­£å¸¸æ”¯ä»˜æµé‡**: 50 ç¬”/ç§’ (2 åˆ†é’Ÿ)
- **æ”¯ä»˜é«˜å³°æœŸ**: 50â†’500 ç¬”/ç§’ (5 åˆ†é’Ÿ)
- **é‡å¤æ”¯ä»˜æ£€æµ‹**: 20 ä¸ªç”¨æˆ·,æ¯äºº 5 æ¬¡é‡å¤æ”¯ä»˜

**æ”¯ä»˜æ–¹å¼**: æ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è” (éšæœº)

**å…³é”®æŒ‡æ ‡**:

- æ”¯ä»˜æˆåŠŸç‡ > 98%
- P95 æ”¯ä»˜æ—¶é•¿ < 3 ç§’
- è¶…æ—¶ç‡ < 1%
- é‡å¤æ”¯ä»˜æ‹¦æˆª = 100%

---

### 6. æ–‡ä»¶ä¸Šä¼ æµ‹è¯• (`upload-performance.js`)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„æ€§èƒ½å’Œç¨³å®šæ€§

**æµ‹è¯•åœºæ™¯**:

- **å°æ–‡ä»¶** (100-500KB): 20 VUs, 1 åˆ†é’Ÿ
- **ä¸­ç­‰æ–‡ä»¶** (1-5MB): 10 VUs, 2 åˆ†é’Ÿ
- **å¤§æ–‡ä»¶** (5-10MB): 5 VUs, 2 åˆ†é’Ÿ

**å…³é”®æŒ‡æ ‡**:

- ä¸Šä¼ æˆåŠŸç‡ > 95%
- P95 ä¸Šä¼ æ—¶é•¿ < 10 ç§’
- å¹³å‡ä¼ è¾“é€Ÿç‡ > 500KB/s

---

### 7. WebSocket æµ‹è¯• (`websocket-test.js`)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ WebSocket å®æ—¶é€šä¿¡æ€§èƒ½

**æµ‹è¯•æµç¨‹**:

1. å»ºç«‹ WebSocket è¿æ¥
2. æ¯ 5 ç§’å‘é€å¿ƒè·³æ¶ˆæ¯
3. æ¯ 10 ç§’å‘é€ä¸šåŠ¡æ¶ˆæ¯
4. ä¿æŒè¿æ¥ 60 ç§’åæ–­å¼€

**è´Ÿè½½æ¨¡å¼**:

```
30ç§’ â†’ 100è¿æ¥
2åˆ†é’Ÿ â†’ 500è¿æ¥
1åˆ†é’Ÿ â†’ 1000è¿æ¥
1åˆ†é’Ÿ â†’ 100è¿æ¥
30ç§’ â†’ 0è¿æ¥
```

**å…³é”®æŒ‡æ ‡**:

- è¿æ¥æˆåŠŸç‡ > 95%
- P95 æ¶ˆæ¯å»¶è¿Ÿ < 100ms
- P95 è¿æ¥å»ºç«‹ < 500ms
- æ¶ˆæ¯ä¸¢å¤±ç‡ < 0.01%

---

### 8. ç»¼åˆå‹åŠ›æµ‹è¯• (`comprehensive-stress.js`)

**æµ‹è¯•ç›®æ ‡**: æ¨¡æ‹ŸçœŸå®ç”Ÿäº§ç¯å¢ƒçš„ç»¼åˆå‹åŠ›åœºæ™¯ (å¦‚é»‘è‰²æ˜ŸæœŸäº”)

**å¹¶å‘åœºæ™¯**:

| åœºæ™¯     | è´Ÿè½½          | æŒç»­æ—¶é—´ | æ‰§è¡Œå™¨                |
| -------- | ------------- | -------- | --------------------- |
| å•†å“æµè§ˆ | 500â†’1000 VUs  | 10 åˆ†é’Ÿ  | ramping-vus           |
| è®¢å•åˆ›å»º | 10â†’200 ç¬”/ç§’  | 10 åˆ†é’Ÿ  | ramping-arrival-rate  |
| æ”¯ä»˜å¤„ç† | 100 ç¬”/ç§’     | 10 åˆ†é’Ÿ  | constant-arrival-rate |
| åå°ç®¡ç† | 20 VUs        | 10 åˆ†é’Ÿ  | constant-vus          |
| æŠ¥è¡¨ç”Ÿæˆ | 10 VUs Ã— 5 æ¬¡ | 10 åˆ†é’Ÿ  | per-vu-iterations     |

**å…³é”®æŒ‡æ ‡**:

- P99 å“åº”æ—¶é—´ < 2 ç§’
- HTTP é”™è¯¯ç‡ < 5%
- æ•´ä½“æˆåŠŸç‡ > 95%
- ä¸¥é‡é”™è¯¯æ•° < 50

---

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### å“åº”æ—¶é—´ç›®æ ‡

| API ç±»å‹ | P50    | P95     | P99     | æœ€å¤§    |
| -------- | ------ | ------- | ------- | ------- |
| ç®€å•æŸ¥è¯¢ | <50ms  | <100ms  | <200ms  | <500ms  |
| å¤æ‚æŸ¥è¯¢ | <100ms | <200ms  | <500ms  | <1000ms |
| å†™æ“ä½œ   | <100ms | <300ms  | <500ms  | <1000ms |
| æ”¯ä»˜æ¥å£ | <500ms | <2000ms | <3000ms | <5000ms |

### ååé‡ç›®æ ‡

- **API è¯·æ±‚**: > 1000 RPS
- **æ”¯ä»˜å¤„ç†**: > 100 ç¬”/ç§’
- **æ•°æ®åº“æŸ¥è¯¢**: > 500 QPS
- **ç¼“å­˜è¯»å–**: > 10000 OPS

### èµ„æºä½¿ç”¨é™åˆ¶

- **CPU ä½¿ç”¨ç‡**: < 80%
- **å†…å­˜ä½¿ç”¨**: < 70%
- **æ•°æ®åº“è¿æ¥**: < 80% (è¿æ¥æ± )
- **Redis è¿æ¥**: < 50%

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. K6 æœªå®‰è£…

```bash
# macOS
brew install k6

# å…¶ä»–ç³»ç»Ÿå‚è€ƒå®˜æ–¹æ–‡æ¡£
https://k6.io/docs/getting-started/installation/
```

#### 2. æµ‹è¯•è¶…æ—¶

**åŸå› **: æœåŠ¡å™¨å“åº”æ…¢æˆ–é…ç½®ä¸å½“  
**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥ `BASE_URL` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤åº”ç”¨æœåŠ¡å™¨å·²å¯åŠ¨
- å¢åŠ è¶…æ—¶æ—¶é—´: `timeout: '30s'`

#### 3. è¿æ¥è¢«æ‹’ç»

**åŸå› **: åº”ç”¨æœåŠ¡å™¨æœªè¿è¡Œæˆ–ç«¯å£ä¸å¯¹  
**è§£å†³æ–¹æ¡ˆ**:

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000
```

#### 4. è®¤è¯å¤±è´¥

**åŸå› **: ç¼ºå°‘æˆ–æ— æ•ˆçš„ API token  
**è§£å†³æ–¹æ¡ˆ**:

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export API_TOKEN="your-valid-token"

# æˆ–åœ¨æµ‹è¯•è„šæœ¬ä¸­ä½¿ç”¨çœŸå®ç™»å½•æµç¨‹
```

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹

### API æ€§èƒ½æµ‹è¯•ç»“æœ

```
APIæ€§èƒ½æµ‹è¯•ç»“æœ
==================================================

è¯·æ±‚ç»Ÿè®¡:
  æ€»è¯·æ±‚æ•°: 15234
  æˆåŠŸç‡: 99.87%
  ä¸šåŠ¡é”™è¯¯ç‡: 0.45%

å“åº”æ—¶é—´:
  å¹³å‡: 87.23ms
  æœ€å°: 12.45ms
  æœ€å¤§: 456.78ms
  P95: 178.90ms
  P99: 289.34ms

ååé‡:
  RPS: 507.80
```

### å¹¶å‘ç”¨æˆ·æµ‹è¯•ç»“æœ

```
å¹¶å‘ç”¨æˆ·æµ‹è¯•ç»“æœ
============================================================

ç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡:
  ç™»å½•æˆåŠŸç‡: 99.95%
  ç»“è´¦æˆåŠŸç‡: 97.82%
  å¹³å‡ä¼šè¯æ—¶é•¿: 45.67s

ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡:
  æ€»è¯·æ±‚æ•°: 234567
  è¯·æ±‚æˆåŠŸç‡: 98.76%
  å¹³å‡å“åº”æ—¶é—´: 145.23ms
  P95å“åº”æ—¶é—´: 298.45ms
  P99å“åº”æ—¶é—´: 567.89ms
  RPS: 389.28
  æ€»é”™è¯¯æ•°: 123

è´Ÿè½½çº§åˆ«åˆ†æ:
  LOWè´Ÿè½½:
    - å¹³å‡å“åº”æ—¶é—´: 89.12ms
    - å¤±è´¥ç‡: 0.23%
  MEDIUMè´Ÿè½½:
    - å¹³å‡å“åº”æ—¶é—´: 156.78ms
    - å¤±è´¥ç‡: 1.45%
  HIGHè´Ÿè½½:
    - å¹³å‡å“åº”æ—¶é—´: 234.56ms
    - å¤±è´¥ç‡: 3.67%
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æ‰§è¡Œæµ‹è¯•**: è¿è¡Œæ‰€æœ‰æ€§èƒ½æµ‹è¯•è„šæœ¬
2. **åˆ†æç»“æœ**: æŸ¥çœ‹æ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–æœºä¼š
3. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–ä»£ç 
4. **å›å½’æµ‹è¯•**: ä¼˜åŒ–åé‡æ–°è¿è¡Œæµ‹è¯•éªŒè¯
5. **æŒç»­ç›‘æ§**: é›†æˆåˆ° CI/CD æµç¨‹

---

## ğŸ“š ç›¸å…³èµ„æº

- **K6 å®˜æ–¹æ–‡æ¡£**: https://k6.io/docs/
- **K6 æœ€ä½³å®è·µ**: https://k6.io/docs/testing-guides/test-types/
- **Grafana K6 äº‘æœåŠ¡**: https://k6.io/cloud/
- **æ€§èƒ½æµ‹è¯•æŒ‡å—**: https://k6.io/docs/testing-guides/

---

**åˆ›å»ºæ—¥æœŸ**: 2025-11-26  
**ç‰ˆæœ¬**: v1.0  
**ç»´æŠ¤è€…**: YYC-Cube
